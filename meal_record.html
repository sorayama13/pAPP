<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áô∫ÈÖµÈ£üÂìÅ„ÉªÈ£üÁâ©ÁπäÁ∂≠Ë®òÈå≤„Ç¢„Éó„É™</title>
    
    <!-- PWAË®≠ÂÆö -->
    <link rel="manifest" href="data:application/json,{&quot;name&quot;:&quot;Áô∫ÈÖµÈ£üÂìÅË®òÈå≤„Ç¢„Éó„É™&quot;,&quot;short_name&quot;:&quot;Áô∫ÈÖµË®òÈå≤&quot;,&quot;description&quot;:&quot;Áô∫ÈÖµÈ£üÂìÅ„ÉªÈ£üÁâ©ÁπäÁ∂≠„ÉªÈ£üÂìÅÂ§öÊßòÊÄß„ÇíË®òÈå≤„Åô„Çã„Ç¢„Éó„É™&quot;,&quot;start_url&quot;:&quot;/&quot;,&quot;display&quot;:&quot;standalone&quot;,&quot;background_color&quot;:&quot;#ffffff&quot;,&quot;theme_color&quot;:&quot;#4CAF50&quot;,&quot;icons&quot;:[{&quot;src&quot;:&quot;data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM0Q0FGNTAiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnptMCAxOGMtNC40MSAwLTgtMy41OS04LTggMy41OS04IDgtOCA0LjQxIDAgOCAzLjU5IDggOC04IDMuNTktOCA4eiIvPgo8L3N2Zz4KPC9zdmc+&quot;,&quot;sizes&quot;:&quot;192x192&quot;,&quot;type&quot;:&quot;image/svg+xml&quot;}],"}"}>
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Áô∫ÈÖµË®òÈå≤">
    
    <!-- Â§ñÈÉ®„É©„Ç§„Éñ„É©„É™ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .date-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            min-width: 44px;
            min-height: 44px;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .reset-btn {
            opacity: 0.7;
            font-size: 14px;
        }
        
        .reset-btn:hover {
            opacity: 1;
        }
        
        .current-date {
            font-size: 18px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .date-changed {
            background: rgba(76, 175, 80, 0.2);
            border-radius: 8px;
            padding: 4px 8px;
            transform: scale(1.05);
        }
        
        .date-status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #dc3545;
            transition: all 0.3s ease;
        }
        
        .status-dot.has-data {
            background: #4CAF50;
        }
        
        .status-dot.partial-data {
            background: #ffc107;
        }
        
        .progress-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .summary-item {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }
        
        .summary-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main-content {
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .section-card {
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 44px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        
        .section-toggle {
            font-size: 20px;
            color: #666;
            transition: transform 0.3s;
        }

        .why-button {
            background: #e9f5ee;
            color: #2e7d32;
            border: 1px solid #cdebd7;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            margin-left: 8px;
        }

        .why-button:hover {
            background: #dff6ea;
        }
        
        .section-toggle.collapsed {
            transform: rotate(-90deg);
        }
        
        .section-content {
            padding: 20px;
            display: block;
        }
        
        .section-content.collapsed {
            display: none;
        }
        
        /* Áô∫ÈÖµÈ£üÂìÅ„Çª„ÇØ„Ç∑„Éß„É≥ */
        .fermented-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .fermented-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            position: relative;
            border: 2px solid transparent;
        }
        
        .fermented-option:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .fermented-option.selected {
            background: #d4edda;
            border: 2px solid #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }
        
        .fermented-icon {
            margin-right: 12px;
            min-width: 42px;
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
            border-radius: 10px;
            font-size: 28px;
        }

        /* ÈÅ∏Êäû„Åï„Çå„ÅüÊôÇ„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÅÆËÉåÊôØ„ÇíÊøÉ„Åè„ÄÅ„Çπ„Ç±„Éº„É´„Ç¢„ÉÉ„Éó */
        .fermented-option.selected .fermented-icon {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .fermented-option.selected[data-name="Á¥çË±Ü"] .fermented-icon {
            background: linear-gradient(135deg, #A0522D 0%, #8B4513 100%) !important;
        }

        .fermented-option.selected[data-name="„É®„Éº„Ç∞„É´„Éà"] .fermented-icon {
            background: linear-gradient(135deg, #64B5F6 0%, #4A90E2 100%) !important;
        }

        .fermented-option.selected[data-name="Âë≥ÂôåÔºàÂë≥ÂôåÊ±ÅÂê´„ÇÄÔºâ"] .fermented-icon {
            background: linear-gradient(135deg, #E89E62 0%, #D2691E 100%) !important;
        }

        .fermented-option.selected[data-name="„Ç≠„É†„ÉÅ„ÉªÊº¨Áâ©"] .fermented-icon {
            background: linear-gradient(135deg, #EF5350 0%, #DC3545 100%) !important;
        }

        .fermented-option.selected[data-name="„ÉÅ„Éº„Ç∫"] .fermented-icon {
            background: linear-gradient(135deg, #FFB74D 0%, #FF9800 100%) !important;
        }

        .fermented-option.selected[data-name="ÁîòÈÖí„ÉªÂ°©È∫π"] .fermented-icon {
            background: linear-gradient(135deg, #BA68C8 0%, #9C27B0 100%) !important;
        }
        
        .fermented-info {
            flex: 1;
        }
        
        .fermented-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }
        
        
        /* Êñ∞„Åó„ÅÑ„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû„Éú„Çø„É≥„Çπ„Çø„Ç§„É´ */
        .fermented-quick-button {
            padding: 20px 12px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .fermented-quick-button:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .fermented-quick-button.selected {
            background: #FFF8DC;
            border-color: #D2691E;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(210, 105, 30, 0.15);
        }

        .fermented-icon-large {
            font-size: 32px;
            margin-bottom: 6px;
        }

        .fermented-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            line-height: 1.2;
            text-align: center;
        }

        .fermented-check {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            opacity: 0;
            transform: scale(0);
            transition: all 0.2s;
        }

        .fermented-quick-button.selected .fermented-check {
            opacity: 1;
            transform: scale(1);
        }
        
        .fermented-summary {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .fermented-summary.achieved {
            background: #FFF8DC;
            border: 2px solid #D2691E;
        }

        .fermented-summary.achieved::before {
            content: 'üéâ ';
        }
        
        /* È£üÁâ©ÁπäÁ∂≠„Çª„ÇØ„Ç∑„Éß„É≥ */
        .fiber-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        /* „Ç´„Çπ„Çø„É†È£üÁâ©ÁπäÁ∂≠ÂÖ•Âäõ */
        .custom-fiber-container {
            margin: 20px 0 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        .custom-fiber-header {
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 12px;
            color: #333;
        }
        .custom-fiber-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 10px;
        }
        .custom-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .custom-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        .add-custom-fiber-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            font-size: 14px;
        }
        .custom-fiber-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 6px;
            font-size: 14px;
        }
        .remove-custom-btn {
            background: #e9ecef;
            color: #888;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-weight: bold;
        }

        /* È£üÁâ©ÁπäÁ∂≠„ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû„Éú„Çø„É≥ÊîπËâØÁâà */
        .fiber-quick-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
            justify-items: stretch;
            max-width: 100%;
        }

        .fiber-button-wrapper {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 100%;
        }

        .fiber-quick-button {
            padding: 12px 8px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 90px;
            width: 100%;
            box-sizing: border-box;
        }

        .fiber-quick-button:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .fiber-quick-button.selected {
            background: #e8f5e9;
            border-color: #4CAF50;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.15);
        }

        .fiber-counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
        }

        .counter-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .counter-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }

        .counter-btn:active {
            transform: scale(0.95);
        }

        .counter-value {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            min-width: 30px;
            text-align: center;
        }

        /* „Ç¢„Ç§„Ç≥„É≥„Çµ„Ç§„Ç∫Ë™øÊï¥ */
        .fiber-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }

        .fiber-name {
            font-size: 11px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            line-height: 1.2;
            text-align: center;
        }

        .fiber-value {
            font-size: 14px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 2px;
        }

        .fiber-unit {
            font-size: 10px;
            color: #666;
            text-align: center;
        }
        
        .fiber-category {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            min-height: 44px;
        }
        
        .fiber-category:hover {
            background: #e9ecef;
            border-color: #4CAF50;
        }
        
        .fiber-category-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .fiber-category-value {
            font-size: 14px;
            color: #666;
        }
        
        .fiber-category-unit {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
        }
        
        .fiber-stepper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .fiber-stepper-btn {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .fiber-stepper-btn:hover {
            background: #45a049;
            transform: scale(1.1);
        }
        
        .fiber-stepper-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .fiber-stepper-amount {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            min-width: 30px;
            text-align: center;
        }
        
        .fiber-summary {
            text-align: center;
            padding: 15px;
            background: #e8f5e8;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .fiber-progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .fiber-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s;
        }
        
        /* È£üÁâ©ÁπäÁ∂≠Ë©≥Á¥∞Ë°®Á§∫ */
        .fiber-details {
            margin: 15px 0;
        }
        
        .fiber-record-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        
        .fiber-record-info {
            display: flex;
            flex-direction: column;
        }
        
        .fiber-record-name {
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }
        
        .fiber-record-value {
            font-size: 12px;
            color: #666;
        }
        
        .remove-fiber-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            min-width: 44px;
            min-height: 44px;
        }
        
        .remove-fiber-btn:hover {
            background: #c82333;
        }
        
        /* ‰ªäÈÄ±„ÅÆÊ§çÁâ©‰∏ÄË¶ßË°®Á§∫ */
        .weekly-plants-list {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .weekly-plants-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .weekly-plants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }
        
        .weekly-plant-tag {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 12px;
            text-align: center;
            border: 1px solid #c8e6c9;
        }
        
        .weekly-plant-tag.duplicate {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }
        
        /* È£üÂìÅÂ§öÊßòÊÄß„Çª„ÇØ„Ç∑„Éß„É≥ */
        .plant-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .plant-input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .plant-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            min-height: 44px;
        }
        
        .plant-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .plant-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .plant-suggestion-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            font-size: 14px;
        }
        
        .plant-suggestion-item:hover {
            background: #f8f9fa;
        }
        
        .plant-suggestion-item:last-child {
            border-bottom: none;
        }
        
        
        .add-plant-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            min-width: 44px;
            min-height: 44px;
        }
        
        .add-plant-btn:hover {
            background: #45a049;
        }
        
        .plants-list {
            margin-top: 15px;
        }
        
        .plant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        
        .plant-name {
            font-size: 14px;
        }
        
        .remove-plant-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .diversity-progress {
            margin-top: 15px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            transition: width 0.3s;
        }
        
        /* „Éú„Éà„É†„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            z-index: 100;
            max-height: 60px;
        }
        
        .nav-item {
            flex: 1;
            padding: 8px 10px;
            text-align: center;
            cursor: pointer;
            color: #666;
            transition: color 0.3s;
            min-height: 44px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .nav-item.active {
            color: #4CAF50;
        }
        
        .nav-icon {
            font-size: 18px;
            margin-bottom: 3px;
        }
        
        .nav-label {
            font-size: 10px;
        }

        
        
        /* „É¨„Éù„Éº„ÉàÁîªÈù¢ */
        .report-section {
            margin-bottom: 30px;
        }
        
        .report-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
        }
        
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñË™øÊï¥ */
        @media (max-width: 480px) {
            .fermented-options {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .fermented-quick-button {
                min-height: 90px;
                padding: 16px 8px;
            }
            
            .fermented-icon-large {
                font-size: 28px;
            }
            
            .fermented-name {
                font-size: 12px;
            }
            
            .fiber-categories {
                grid-template-columns: 1fr;
            }
            
            .fiber-quick-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
                justify-items: stretch;
            }
            
            .fiber-button-wrapper {
                max-width: none;
            }
            
            .fiber-quick-button {
                padding: 10px 6px;
                min-height: 80px;
            }
            
            .fiber-icon {
                font-size: 20px;
            }
            
            .fiber-name {
                font-size: 10px;
            }
            
            .fiber-value {
                font-size: 13px;
            }
            
            .fiber-unit {
                font-size: 9px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .fermented-quick-button {
                min-height: 85px;
                padding: 14px 6px;
            }
            
            .fermented-icon-large {
                font-size: 26px;
            }
            
            .fermented-name {
                font-size: 11px;
            }
            
        }
        
        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            animation: fadeIn 0.3s ease-in;
        }
        
        /* Ë®≠ÂÆöÁîªÈù¢ */
        .settings-section {
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            padding-bottom: 8px;
            border-bottom: 2px solid #4CAF50;
        }
        
        .setting-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .setting-label {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .gender-options {
            display: flex;
            gap: 10px;
        }
        
        .gender-option {
            flex: 1;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .gender-option.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .fiber-goal-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .fiber-goal-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            font-size: 16px;
        }
        
        .fiber-goal-input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .fiber-goal-unit {
            font-size: 14px;
            color: #666;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº */
        .calendar-container {
            padding: 15px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-header h3 {
            font-size: 18px;
            color: #333;
        }
        
        .calendar-header button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .calendar-header button:hover {
            background: #45a049;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 15px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }
        
        .weekday-header {
            text-align: center;
            padding: 10px 5px;
            font-weight: bold;
            color: #666;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 45px;
            max-height: 45px;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }
        
        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            transform: none;
        }
        
        .day-number {
            font-size: 12px;
            font-weight: bold;
            color: #333;
        }
        
        .day-status {
            font-size: 10px;
            margin-top: 1px;
        }
        
        .record-stats {
            display: flex;
            flex-direction: column; /* 3„Å§„ÅÆÈ†ÖÁõÆ„ÇíÁ∏¶„Å´‰∏¶„Åπ„Çã */
            align-items: flex-start; /* Â∑¶ÊèÉ„Åà„Å´„Åô„Çã */
            gap: 1px;               /* ÂêÑÈ†ÖÁõÆ„ÅÆÈñì„ÅÆ„Çπ„Éö„Éº„Çπ */
            width: 100%;
            padding: 0 5px;         /* Â∑¶Âè≥„ÅÆ‰ΩôÁôΩ„ÇíËøΩÂä† */
        }

        .stat-item {
            display: flex;
            flex-direction: row;    /* „Ç¢„Ç§„Ç≥„É≥„Å®Êï∞ÂÄ§„ÇíÊ®™‰∏¶„Å≥„Å´„Åô„Çã */
            align-items: center;
            gap: 4px;               /* „Ç¢„Ç§„Ç≥„É≥„Å®Êï∞ÂÄ§„ÅÆÈñì„ÅÆ„Çπ„Éö„Éº„Çπ */
            font-size: 9px;         /* „ÉÜ„Ç≠„Çπ„Éà„ÇíË™≠„Åø„ÇÑ„Åô„Åè„Åô„Çã */
        }

        .stat-icon {
            font-size: 10px;
            width: 11px;            /* „Ç¢„Ç§„Ç≥„É≥„ÅÆÂπÖ„ÇíÂõ∫ÂÆö„Åó„Å¶Êï¥Âàó„Åï„Åõ„Çã */
            text-align: center;
        }

        .stat-value {
            font-weight: 600;
            color: #333;
            line-height: 1.2;
        }

        .fermented-stat .stat-value {
            color: #8B4513;
        }

        .fiber-stat .stat-value {
            color: #FF9800;
        }

        .plant-stat .stat-value {
            color: #4CAF50;
        }
        
        .calendar-day.no-record {
            background: #fff;
            color: #999;
        }
        
        .calendar-day.recorded {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .calendar-day.partial {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .calendar-day.perfect {
            background: #e8f5e8;
            color: #2e7d32;
        }

        /* „Éï„É©„ÉØ„Éº„Éá„Ç∂„Ç§„É≥ */
        .health-flower {
            position: relative;
            width: 32px;
            height: 32px;
            margin: auto;
        }

        .flower-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #FFD700;
            z-index: 2;
            box-shadow: 0 0 3px rgba(255, 215, 0, 0.5);
        }

        .petal {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50% 0;
            transform-origin: 50% 50%;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .petal.fermented {
            top: 2px;
            left: 50%;
            transform: translateX(-50%) rotate(0deg);
            background: #D2691E;
        }

        .petal.fiber {
            bottom: 4px;
            right: 4px;
            transform: rotate(120deg);
            background: #FF9800;
        }

        .petal.plants {
            bottom: 4px;
            left: 4px;
            transform: rotate(240deg);
            background: #4CAF50;
        }

        .petal.show {
            opacity: 1;
        }

        .petal.low {
            opacity: 0.4;
        }

        .petal.medium {
            opacity: 0.7;
        }

        .petal.high {
            opacity: 1;
            transform: scale(1.1);
        }

        .calendar-day.perfect .flower-center {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
        }

        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 6px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 10;
        }

        .calendar-day:hover .tooltip {
            opacity: 1;
        }

        /* 1ÈÄ±ÁõÆ„ÅÆ„ÉÅ„ÉÉ„Éó‰ΩçÁΩÆË™øÊï¥ */
        .calendar-day:nth-child(-n+7) .tooltip {
            bottom: auto;
            top: 100%;
            margin-bottom: 0;
            margin-top: 5px;
        }

        .tooltip-content {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .tooltip-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tooltip-icon {
            font-size: 12px;
        }

        /* Ê∞ó„Å•„Åç„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅÆËÉåÊôØË°®Áèæ */
        .calendar-day.has-insights {
            background: linear-gradient(135deg, #fff 65%, #FFF3E0 65%);
        }

        .calendar-day.has-critical-insights {
            background: linear-gradient(135deg, #fff 65%, #FFE5E5 65%);
        }

        /* „Éõ„Éê„ÉºÊôÇ„ÅÆÂº∑Ë™ø */
        .calendar-day.has-insights:hover {
            background: linear-gradient(135deg, #fff 60%, #FFF3E0 60%);
        }

        .calendar-day.has-critical-insights:hover {
            background: linear-gradient(135deg, #fff 60%, #FFE5E5 60%);
        }

        /* „ÉÑ„Éº„É´„ÉÅ„ÉÉ„ÉóÂÜÖ„ÅÆÊ∞ó„Å•„ÅçË°®Á§∫ */
        .tooltip-insights {
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 12px;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 400px) {
            .calendar-day.has-insights {
                background: linear-gradient(135deg, #fff 55%, #FFF3E0 55%);
            }
            
            .calendar-day.has-critical-insights {
                background: linear-gradient(135deg, #fff 55%, #FFE5E5 55%);
            }
        }
        
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-dot.perfect {
            background: #2e7d32;
        }
        
        .legend-dot.partial {
            background: #f57c00;
        }
        
        .legend-dot.recorded {
            background: #1976d2;
        }
        
        /* 2ÈÄ±Èñì„É¨„Éù„Éº„ÉàÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .biweekly-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .biweekly-nav-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .biweekly-nav-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
        }
        
        .biweekly-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .biweekly-period-text {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            text-align: center;
            flex: 1;
        }
        
        /* 2ÈÄ±Èñì„É¨„Éù„Éº„ÉàÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .report-title-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .report-title-container .why-button {
            font-style: italic;
            font-weight: bold;
            font-family: serif;
            width: 24px;
            height: 24px;
            font-size: 16px;
        }
        
        .plant-goal-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .plant-goal-item {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
        }
        
        .plant-goal-item.achieved {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .plant-goal-item.not-achieved {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .plant-goal-week {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* Tips„É¢„Éº„ÉÄ„É´Áî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 3000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .info-modal-content {
            background: #fff;
            max-width: 460px;
            width: 100%;
            border-radius: 14px;
            padding: 20px 25px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .info-modal-content h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .info-modal-content p {
            font-size: 14px;
            line-height: 1.7;
            margin-bottom: 10px;
        }
        
        .info-modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
            background: #f0f0f0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            line-height: 32px;
        }
        
        /* „É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥ */
        .memo-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .memo-textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .memo-save-info {
            margin-top: 10px;
            text-align: right;
            color: #999;
        }
        
        /* ‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„Çª„ÇØ„Ç∑„Éß„É≥ */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }

        .insight-tag {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 45px;
        }

        .insight-tag:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .insight-tag.selected {
            background: #e8f5e8;
            border-color: #4CAF50;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.15);
        }

        .insight-icon {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .insight-label {
            font-size: 10px;
            font-weight: 600;
            color: #333;
            text-align: center;
            line-height: 1.2;
        }

        .insights-summary {
            text-align: center;
            padding: 6px 8px;
            background: #f8f9fa;
            border-radius: 6px;
            font-size: 11px;
            color: #666;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 360px) {
            .insights-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 4px;
            }
            
            .insight-tag {
                padding: 6px 2px;
                min-height: 40px;
            }
            
            .insight-icon {
                font-size: 16px;
            }
            
            .insight-label {
                font-size: 9px;
            }
        }

        
    </style>
</head>
<body>
    <div class="container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="header">
            <div class="date-nav">
                <button class="nav-btn" onclick="changeDate(-1)">‚Äπ</button>
                <div>
                    <div class="current-date" id="currentDate"></div>
                    <div class="date-status-indicator">
                        <span class="status-dot" id="statusDot"></span>
                        <span id="statusText">Êú™Ë®òÈå≤</span>
                    </div>
                </div>
                <button class="nav-btn" onclick="changeDate(1)">‚Ä∫</button>
                <button class="nav-btn reset-btn" onclick="resetAllData()" title="„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà">üîÑ</button>
            </div>
            <div class="progress-summary">
                <div class="summary-item">
                    <div class="summary-value" id="fermentedCount">0</div>
                    <div class="summary-label">Áô∫ÈÖµÈ£üÂìÅ</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="fiberCount">0g</div>
                    <div class="summary-label">È£üÁâ©ÁπäÁ∂≠</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value" id="plantCount">0</div>
                    <div class="summary-label">Ê§çÁâ©Á®ÆÈ°û</div>
                </div>
            </div>
        </header>

        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <main class="main-content" id="mainContent">
            <!-- Áô∫ÈÖµÈ£üÂìÅË®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('fermented')">
                    <div class="section-title">Áô∫ÈÖµÈ£üÂìÅË®òÈå≤</div>
                    <button class="why-button" title="„Å™„ÅúË®òÈå≤„Åô„ÇãÔºü" onclick="event.stopPropagation(); showWhyModal('fermented')">?</button>
                    <div class="section-toggle" id="fermentedToggle">‚ñº</div>
                </div>
                <div class="section-content" id="fermentedContent">
                    <div class="fermented-options" id="fermentedOptions">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div class="fermented-summary" id="fermentedSummary">
                        ‰ªäÊó•„ÅØ <span id="fermentedSelected">0</span> Á®ÆÈ°û„ÅÆÁô∫ÈÖµÈ£üÂìÅ„ÇíÈ£ü„Åπ„Åæ„Åó„Åü
                        <br>
                        <small>ÁõÆÊ®ô: 1Êó•2Á®ÆÈ°û‰ª•‰∏ä</small>
                    </div>
                </div>
            </div>

            <!-- È£üÁâ©ÁπäÁ∂≠Ë®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('fiber')">
                    <div class="section-title">È£üÁâ©ÁπäÁ∂≠Ë®òÈå≤</div>
                    <button class="why-button" title="„Å™„ÅúË®òÈå≤„Åô„ÇãÔºü" onclick="event.stopPropagation(); showWhyModal('fiber')">?</button>
                    <div class="section-toggle" id="fiberToggle">‚ñº</div>
                </div>
                <div class="section-content" id="fiberContent">
                    <div class="fiber-categories" id="fiberCategories">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div class="custom-fiber-container">
                        <div class="custom-fiber-header">„Åù„ÅÆ‰ªñ„ÅÆÈ£üÂìÅ„ÇíËøΩÂä†</div>
                        <div class="custom-fiber-input-group">
                            <input type="text" id="customFiberName" class="custom-input" placeholder="È£üÂìÅÂêç (‰æã: „Éó„É≠„ÉÜ„Ç§„É≥„Éê„Éº)">
                            <input type="number" id="customFiberAmount" class="custom-input" placeholder="Èáè(g)" inputmode="decimal" step="0.1">
                            <button class="add-custom-fiber-btn" onclick="addCustomFiber()">ËøΩÂä†</button>
                        </div>
                        <div id="customFiberList"></div>
                    </div>
                    <div class="fiber-details" id="fiberDetails">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãË®òÈå≤Ë©≥Á¥∞ -->
                    </div>
                    <div class="fiber-summary" id="fiberSummary">
                        <div>‰ªäÊó•„ÅÆÈ£üÁâ©ÁπäÁ∂≠: <span id="fiberTotal">0</span>g / <span id="fiberGoal">18</span>g</div>
                        <div class="fiber-progress">
                            <div class="fiber-progress-bar" id="fiberProgressBar" style="width: 0%"></div>
                        </div>
                        <small>ÁõÆÊ®ôÈÅîÊàê„Åæ„Åß <span id="fiberRemaining">18</span>g</small>
                    </div>
                </div>
            </div>

            <!-- È£üÂìÅÂ§öÊßòÊÄßË®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('plants')">
                    <div class="section-title">È£üÂìÅÂ§öÊßòÊÄßË®òÈå≤</div>
                    <button class="why-button" title="„Å™„ÅúË®òÈå≤„Åô„ÇãÔºü" onclick="event.stopPropagation(); showWhyModal('plants')">?</button>
                    <div class="section-toggle" id="plantsToggle">‚ñº</div>
                </div>
                <div class="section-content" id="plantsContent">
                    <div class="plant-input-container">
                        <div class="plant-input-wrapper">
                            <input type="text" class="plant-input" id="plantInput" placeholder="Ê§çÁâ©Âêç„ÇíÂÖ•ÂäõÔºà‰æã: „Éà„Éû„ÉàÔºâ" autocomplete="off">
                            <div class="plant-suggestions" id="plantSuggestions"></div>
                        </div>
                        <button class="add-plant-btn" onclick="addPlant()">ËøΩÂä†</button>
                    </div>
                    <div class="plants-list" id="plantsList">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div class="weekly-plants-list" id="weeklyPlantsList">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã‰ªäÈÄ±„ÅÆÊ§çÁâ©‰∏ÄË¶ß -->
                    </div>
                    <div class="diversity-progress">
                        <div>‰ªäÈÄ±„ÅÆÊ§çÁâ©Á®ÆÈ°û: <span id="weeklyPlantCount">0</span> / 30Á®ÆÈ°û</div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="weeklyPlantProgress" style="width: 0%"></div>
                        </div>
                        <small>ÁõÆÊ®ô: ÈÄ±30Á®ÆÈ°û</small>
                    </div>
                </div>
            </div>

            <!-- ‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('insights')">
                    <div class="section-title">üí° ‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç</div>
                    <div class="section-toggle" id="insightsToggle">‚ñº</div>
                </div>
                <div class="section-content" id="insightsContent">
                    <div class="insights-grid" id="insightsGrid">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div class="insights-summary" id="insightsSummary">
                        <!-- ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Ç∞Êï∞„ÇíË°®Á§∫ -->
                    </div>
                </div>
            </div>

            <!-- „É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-card">
                <div class="section-header" onclick="toggleSection('memo')">
                    <div class="section-title">üìù „É°„É¢</div>
                    <div class="section-toggle" id="memoToggle">‚ñº</div>
                </div>
                <div class="section-content" id="memoContent">
                    <textarea id="memoTextarea" class="memo-textarea" placeholder="‰ªäÊó•„ÅÆÈ£ü‰∫ã„ÇÑ‰ΩìË™ø„ÄÅÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíËá™Áî±„Å´„É°„É¢„Åß„Åç„Åæ„Åô"></textarea>
                    <div class="memo-save-info">
                        <small>‚úì ÂÖ•ÂäõÂÜÖÂÆπ„ÅØËá™Âãï‰øùÂ≠ò„Åï„Çå„Åæ„Åô</small>
                    </div>
                </div>
            </div>
        </main>

        <!-- „Éú„Éà„É†„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
        <nav class="bottom-nav">
            <div class="nav-item active" onclick="showPage('main')">
                <div class="nav-icon">üìù</div>
                <div class="nav-label">Ë®òÈå≤</div>
            </div>
            <div class="nav-item" onclick="showPage('calendar')">
                <div class="nav-icon">üìÖ</div>
                <div class="nav-label">„Ç´„É¨„É≥„ÉÄ„Éº</div>
            </div>
            <div class="nav-item" onclick="showPage('biweekly')">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">„É¨„Éù„Éº„Éà</div>
            </div>
            <div class="nav-item" onclick="showPage('settings')">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-label">Ë®≠ÂÆö</div>
            </div>
        </nav>
    </div>


    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentDate = new Date();
        let appData = {};
        let settings = {
            gender: 'female',
            fiberGoal: 18,
            notifications: true
        };
        let currentPage = 'main';
        let calendarYear = new Date().getFullYear();
        let calendarMonth = new Date().getMonth();
        let biweeklyOffset = 0; // 2ÈÄ±Èñì„É¨„Éù„Éº„Éà„ÅÆÊúüÈñì„Ç™„Éï„Çª„ÉÉ„ÉàÔºà0=‰ªäÈÄ±Âü∫Ê∫ñ„ÄÅ-1=2ÈÄ±ÈñìÂâç„Å™„Å©Ôºâ
        let selectedDate = null; // ÈÅ∏Êäû„Åï„Çå„ÅüÊó•‰ªòÔºàË©≥Á¥∞Ë°®Á§∫Áî®Ôºâ

        // Ê∞ó„Å•„Åç„Çø„Ç∞
        const insightTags = [
            // È£ü‰∫ãÈáè
            { id: 'more', icon: 'üçΩÔ∏è', label: 'Â§ö„ÇÅ', category: 'amount' },
            { id: 'less', icon: 'ü•Ñ', label: 'Â∞ë„Å™„ÇÅ', category: 'amount' },
            { id: 'spicy', icon: 'üå∂Ô∏è', label: 'Ëæõ„ÅÑ', category: 'taste' },
            
            // Ê∞¥ÂàÜ
            { id: 'water-more', icon: 'üíß', label: 'Ê∞¥ÂàÜÂ§ö', category: 'water' },
            { id: 'water-less', icon: 'üèúÔ∏è', label: 'Ê∞¥ÂàÜÂ∞ë', category: 'water' },
            { id: 'caffeine', icon: '‚òï', label: '„Ç´„Éï„Çß„Ç§„É≥', category: 'water' },
            
            // ‰ΩìË™ø„ÉªÊ¥ªÂãï
            { id: 'exercise', icon: 'üèÉ', label: 'ÈÅãÂãï', category: 'activity' },
            { id: 'sleep-lack', icon: 'üò¥', label: 'Áù°Áú†‰∏çË∂≥', category: 'condition' },
            { id: 'medicine', icon: 'üíä', label: 'Ëñ¨', category: 'condition' }
        ];

        // Áô∫ÈÖµÈ£üÂìÅ„ÅÆÈÅ∏ÊäûËÇ¢Ôºà„Ç´„É©„Éï„É´„Ç¢„Ç§„Ç≥„É≥‰ªò„ÅçÔºâ
        const fermentedOptions = [
            { 
                name: 'Á¥çË±Ü', 
                icon: 'ü´ò',
                color: '#8B4513',
                bgColor: '#FFF8DC',
                description: 'Â§ßË±Ü„ÇíÁô∫ÈÖµ„Åï„Åõ„ÅüÊó•Êú¨„ÅÆ‰ºùÁµ±È£üÂìÅ' 
            },
            { 
                name: '„É®„Éº„Ç∞„É´„Éà', 
                icon: 'ü•õ',
                color: '#4A90E2',
                bgColor: '#E3F2FD',
                description: '‰π≥ÈÖ∏Ëèå„ÅßÁô∫ÈÖµ„Åï„Åõ„Åü‰π≥Ë£ΩÂìÅ' 
            },
            { 
                name: 'Âë≥ÂôåÔºàÂë≥ÂôåÊ±ÅÂê´„ÇÄÔºâ', 
                icon: 'üç≤',
                color: '#D2691E',
                bgColor: '#FFF3E0',
                description: 'Â§ßË±Ü„ÇíÈ∫π„ÅßÁô∫ÈÖµ„Åï„Åõ„ÅüË™øÂë≥Êñô' 
            },
            { 
                name: '„Ç≠„É†„ÉÅ„ÉªÊº¨Áâ©', 
                icon: 'ü•¨',
                color: '#DC3545',
                bgColor: '#FFEBEE',
                description: 'ÈáéËèú„Çí‰π≥ÈÖ∏Áô∫ÈÖµ„Åï„Åõ„Åü‰øùÂ≠òÈ£ü' 
            },
            { 
                name: '„ÉÅ„Éº„Ç∫', 
                icon: 'üßÄ',
                color: '#FF9800',
                bgColor: '#FFF8E1',
                description: 'Áâõ‰π≥„Çí‰π≥ÈÖ∏Ëèå„ÅßÁô∫ÈÖµ„Åï„Åõ„Åü‰π≥Ë£ΩÂìÅ' 
            },
            { 
                name: 'ÁîòÈÖí„ÉªÂ°©È∫π', 
                icon: 'üç∂',
                color: '#9C27B0',
                bgColor: '#F3E5F5',
                description: 'Á±≥È∫π„ÅßÁô∫ÈÖµ„Åï„Åõ„ÅüÊó•Êú¨„ÅÆÁô∫ÈÖµË™øÂë≥Êñô' 
            }
        ];

        // È£üÁâ©ÁπäÁ∂≠„Ç´„ÉÜ„Ç¥„É™
        const fiberCategories = [
            { name: 'ÁîüÈáéËèú„Çµ„É©„ÉÄ', value: 3, unit: '1Áöø(100g)' },
            { name: 'Ê∏©ÈáéËèú„ÉªÁÖÆÁâ©', value: 5, unit: '1Áöø(100g)' },
            { name: 'ÈáéËèú„Çπ„Éº„Éó„ÉªÂë≥ÂôåÊ±Å', value: 2, unit: '1ÊùØ(200ml)' },
            { name: 'Êµ∑ËóªÈ°û', value: 1, unit: '1Áöø(50g)' },
            { name: 'ÁéÑÁ±≥„ÉªÈõëÁ©ÄÁ±≥', value: 3, unit: 'Ëå∂Á¢ó1ËÜ≥(150g)' },
            { name: 'Á¥çË±Ü', value: 3, unit: '1„Éë„ÉÉ„ÇØ(50g)' },
            { name: '„Åç„ÅÆ„ÅìÈ°û', value: 2, unit: '1Áöø(50g)' },
            { name: 'ÊûúÁâ©', value: 2, unit: '1ÂÄã(100g)' }
        ];

        // Ê§çÁâ©„Éá„Éº„Çø„Éô„Éº„Çπ
        const plantDatabase = {
            'Á©ÄÁâ©È°û': {
                'Á±≥È°û': ['ÁéÑÁ±≥', 'Áô∫ËäΩÁéÑÁ±≥', '„ÇÇ„Å°È∫¶', 'Êäº„ÅóÈ∫¶', 'ÈªíÁ±≥', 'Ëµ§Á±≥', 'ÈõëÁ©ÄÁ±≥„Éü„ÉÉ„ÇØ„Çπ'],
                'Â∞èÈ∫¶È°û': ['ÂÖ®Á≤íÁ≤â„Éë„É≥', 'ÂÖ®Á≤íÁ≤â„Éë„Çπ„Çø', '„É©„Ç§È∫¶„Éë„É≥', '„Åµ„Åô„ÅæÔºà„Éñ„É©„É≥Ôºâ'],
                '„Åù„ÅÆ‰ªñ': ['„Ç™„Éº„Éà„Éü„Éº„É´ÔºàÁáïÈ∫¶Ôºâ', '„Ç≠„Éå„Ç¢', '„Ç¢„Éû„É©„É≥„Çµ„Çπ', '„Åù„Å∞', '„ÅØ„Å®È∫¶', '„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó']
            },
            'Ë±ÜÈ°û„ÉªÂ§ßË±ÜË£ΩÂìÅ': {
                'Â§ßË±ÜË£ΩÂìÅ': ['Ë±ÜËÖêÔºàÊú®Á∂ø„ÉªÁµπÔºâ', 'Á¥çË±Ü', 'Ë±Ü‰π≥', '„Åä„Åã„Çâ', 'Ê≤πÊèö„Åí', 'ÂéöÊèö„Åí', 'È´òÈáéË±ÜËÖê', 'ÊûùË±Ü', '„ÉÜ„É≥„Éö', '„ÇÜ„Å∞'],
                'ÂêÑÁ®Æ„ÅÆË±Ü': ['„Å≤„Çà„ÅìË±Ü', '„É¨„É≥„Ç∫Ë±ÜÔºàËå∂„ÉªËµ§„ÉªÁ∑ëÔºâ', 'Â∞èË±Ü', 'ÈªíË±Ü', 'ÈáëÊôÇË±Ü', 'ÁôΩ„ÅÑ„Çì„Åí„ÇìË±Ü', '„ÅÜ„Åö„ÇâË±Ü', '„Ç∞„É™„Éº„É≥„Éî„Éº„Çπ']
            },
            'ÈáéËèú': {
                'ËëâÁâ©ÈáéËèú': ['„Åª„ÅÜ„Çå„ÇìËçâ', 'Â∞èÊùæËèú', 'Êò•Ëèä', 'Ê∞¥Ëèú', '„ÉÅ„É≥„Ç≤„É≥Ëèú', '„Ç≠„É£„Éô„ÉÑ', '„É¨„Çø„Çπ', '„Çµ„Éã„Éº„É¨„Çø„Çπ', '„É´„ÉÉ„Ç≥„É©', '„Ç±„Éº„É´', 'ÁôΩËèú', '„Éã„É©', '„Çè„Åë„Åé'],
                '„Ç¢„Éñ„É©„ÉäÁßëÈáéËèú': ['„Éñ„É≠„ÉÉ„Ç≥„É™„Éº', '„Ç´„É™„Éï„É©„ÉØ„Éº', 'ËäΩ„Ç≠„É£„Éô„ÉÑ', 'Ëèú„ÅÆËä±', '„Åã„Å∂„ÅÆËëâ'],
                'ÊûúËèú': ['„Éà„Éû„ÉàÔºàÂ§ßÁéâ„Éª„Éü„ÉãÔºâ', '„Åç„ÇÖ„ÅÜ„Çä', '„Å™„Åô', '„Éî„Éº„Éû„É≥', '„Éë„Éó„É™„Ç´ÔºàËµ§„ÉªÈªÑÔºâ', '„Åã„Åº„Å°„ÇÉ', '„Ç∫„ÉÉ„Ç≠„Éº„Éã', '„Ç¥„Éº„É§', '„Ç™„ÇØ„É©', 'ÂÜ¨Áìú'],
                'Ê†πËèú': ['Â§ßÊ†π', '„Å´„Çì„Åò„Çì', '„Åî„Åº„ÅÜ', '„Çå„Çì„Åì„Çì', '„Åã„Å∂', '„Éì„Éº„ÉÑ', '„Åó„Çá„ÅÜ„Åå', '„É©„Éá„Ç£„ÉÉ„Ç∑„É•'],
                '„Ç§„É¢È°û': ['„Åò„ÇÉ„Åå„ÅÑ„ÇÇ', '„Åï„Å§„Åæ„ÅÑ„ÇÇ', 'ÈáåËäã', 'Â±±ËäãÔºàÈï∑Ëäã„ÉªËá™ÁÑ∂ËñØÔºâ'],
                '„Éç„ÇÆÈ°û': ['Áéâ„Å≠„Åé', 'Èï∑„Å≠„Åé', '„Å´„Çì„Å´„Åè', '„Çâ„Å£„Åç„Çá„ÅÜ', '„ÅÇ„Åï„Å§„Åç']
            },
            'ÊûúÁâ©': {
                '„Éô„É™„ÉºÈ°û': ['„ÅÑ„Å°„Åî', '„Éñ„É´„Éº„Éô„É™„Éº', '„É©„Ç∫„Éô„É™„Éº', '„ÇØ„É©„É≥„Éô„É™„Éº'],
                'ÊüëÊ©òÈ°û': ['„Åø„Åã„Çì', '„Ç™„É¨„É≥„Ç∏', '„Ç∞„É¨„Éº„Éó„Éï„É´„Éº„ÉÑ', '„É¨„É¢„É≥', '„ÇÜ„Åö', '„Åô„Å†„Å°'],
                '„Åù„ÅÆ‰ªñ„ÅÆÊûúÁâ©': ['„Çä„Çì„Åî', '„Éê„Éä„Éä', '„Ç≠„Ç¶„Ç§„Éï„É´„Éº„ÉÑ', '„Å∂„Å©„ÅÜ', 'Ê¢®', 'Êüø', 'Ê°É', '„Åô„ÅÑ„Åã', '„É°„É≠„É≥', '„Éë„Ç§„Éä„ÉÉ„Éó„É´', '„Éû„É≥„Ç¥„Éº', '„Ç¢„Éú„Ç´„Éâ', '„ÅÑ„Å°„Åò„Åè', '„Éó„É´„Éº„É≥']
            },
            '„Åç„ÅÆ„ÅìÈ°û': {
                '„Åç„ÅÆ„Åì': ['„Åó„ÅÑ„Åü„Åë', '„Åó„ÇÅ„ÅòÔºà„Å∂„Å™„Åó„ÇÅ„Åò„ÉªÊú¨„Åó„ÇÅ„ÅòÔºâ', '„Åà„ÅÆ„Åç', '„Ç®„É™„É≥„ÇÆ', '„Éû„ÉÉ„Ç∑„É•„É´„Éº„É†ÔºàÁôΩ„ÉªËå∂Ôºâ', 'ËàûËå∏', '„Å™„ÇÅ„Åì', '„Åç„Åè„Çâ„Åí']
            },
            'Á®ÆÂÆüÈ°û': {
                '„Éä„ÉÉ„ÉÑ': ['„Ç¢„Éº„É¢„É≥„Éâ', '„Åè„Çã„Åø', '„Ç´„Ç∑„É•„Éº„Éä„ÉÉ„ÉÑ', '„Éî„Çπ„Çø„ÉÅ„Ç™', '„Éû„Ç´„ÉÄ„Éü„Ç¢„Éä„ÉÉ„ÉÑ', '„Éî„Éº„Ç´„É≥„Éä„ÉÉ„ÉÑ', '„Éò„Éº„Çº„É´„Éä„ÉÉ„ÉÑ', '„Åé„Çì„Å™„Çì'],
                '„Ç∑„Éº„Éâ': ['„Åî„ÅæÔºàÁôΩ„ÉªÈªí„ÉªÈáëÔºâ', '„Åã„Åº„Å°„ÇÉ„ÅÆÁ®Æ', '„Å≤„Åæ„Çè„Çä„ÅÆÁ®Æ', '„ÉÅ„Ç¢„Ç∑„Éº„Éâ', '„Éï„É©„ÉÉ„ÇØ„Çπ„Ç∑„Éº„ÉâÔºà‰∫úÈ∫ª‰ªÅÔºâ', '„Éò„É≥„Éó„Ç∑„Éº„Éâ']
            },
            'Êµ∑ËóªÈ°û': {
                'Êµ∑Ëóª': ['„Çè„Åã„ÇÅ', 'ÊòÜÂ∏É', '„Å≤„Åò„Åç', '„ÅÆ„ÇäÔºàÁÑº„Åç„ÅÆ„Çä„ÉªÈùí„ÅÆ„ÇäÔºâ', '„ÇÇ„Åö„Åè', '„ÇÅ„Åã„Å∂', 'ÂØíÂ§©']
            },
            '„Éè„Éº„Éñ„Éª„Çπ„Éë„Ç§„ÇπÈ°û': {
                '„Éï„É¨„ÉÉ„Ç∑„É•„Éè„Éº„Éñ': ['Â§ßËëâÔºà„Åó„ÅùÔºâ', '„Éë„Çª„É™', '„Éü„É≥„Éà', '„Éê„Ç∏„É´', '„Éë„ÇØ„ÉÅ„ÉºÔºà„Ç≥„É™„Ç¢„É≥„ÉÄ„ÉºÔºâ', '„Éá„Ç£„É´', '„É≠„Éº„Ç∫„Éû„É™„Éº'],
                '„Çπ„Éë„Ç§„Çπ': ['ÂîêËæõÂ≠ê', 'ËÉ°Ê§í', '„Ç∑„Éä„É¢„É≥', '„Çø„Éº„É°„É™„ÉÉ„ÇØÔºà„Ç¶„Ç≥„É≥Ôºâ', '„ÇØ„Éü„É≥', '„Éä„ÉÑ„É°„Ç∞', 'Â±±Ê§í', '„ÇØ„É≠„Éº„Éñ']
            }
        };

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadSettings();
            initializeApp();
            setupEventListeners();
        });

        // „Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        function loadData() {
            try {
                const savedData = localStorage.getItem('pmcAppData');
                if (savedData) {
                    appData = JSON.parse(savedData);
                }
            } catch (error) {
                console.error('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                showMessage('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // Ë®≠ÂÆöË™≠„ÅøËæº„Åø
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('pmcAppSettings');
                if (savedSettings) {
                    settings = { ...settings, ...JSON.parse(savedSettings) };
                }
            } catch (error) {
                console.error('Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
            }
        }

        // „Éá„Éº„Çø‰øùÂ≠ò
        function saveData() {
            try {
                localStorage.setItem('pmcAppData', JSON.stringify(appData));
            } catch (error) {
                console.error('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                showMessage('„Éá„Éº„Çø„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // Ë®≠ÂÆö‰øùÂ≠ò
        function saveSettings() {
            try {
                localStorage.setItem('pmcAppSettings', JSON.stringify(settings));
            } catch (error) {
                console.error('Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', error);
                showMessage('Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Ç¢„Éó„É™ÂàùÊúüÂåñ
        function initializeApp() {
            updateDateDisplay();
            initializeFermentedOptions();
            initializeFiberCategories();
            initializeInsightTags();
            updateSummary();
            loadCurrentDayData();
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            // Ê§çÁâ©ÂÖ•Âäõ„ÅßEnter„Ç≠„ÉºÂØæÂøúÔºà„Ç§„Éô„É≥„Éà„Éá„É™„Ç≤„Éº„Ç∑„Éß„É≥Ôºâ
            document.addEventListener('keypress', function(e) {
                if (e.target.id === 'plantInput' && e.key === 'Enter') {
                    addPlant();
                }
            });

            // Ê§çÁâ©ÂÖ•Âäõ„ÅÆ„Ç™„Éº„Éà„Ç≥„É≥„Éó„É™„Éº„ÉàÔºà„Éö„Éº„Ç∏„ÅåÂàá„ÇäÊõø„Çè„Å£„Å¶„ÇÇÂÆâÂÖ®„Å´Âãï‰ΩúÔºâ
            document.addEventListener('input', function(e) {
                if (e.target.id === 'plantInput') {
                showPlantSuggestions(e.target.value);
                }
            });

            // Ê§çÁâ©ÂÖ•Âäõ„ÅÆ„Éï„Ç©„Éº„Ç´„ÇπÂ§ñ„ÅßÂÄôË£ú„ÇíÈùûË°®Á§∫
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.plant-input-wrapper')) {
                    hidePlantSuggestions();
                }
            });

            // „É°„É¢„ÅÆËá™Âãï‰øùÂ≠ò
            document.addEventListener('input', function(e) {
                if (e.target.id === 'memoTextarea') {
                    saveMemo(e.target.value);
                }
            });

            // PWAÂØæÂøú
            if ('serviceWorker' in navigator && location.protocol === 'https:' || location.hostname === 'localhost') {
                navigator.serviceWorker.register('data:text/javascript,console.log("PWA Service Worker")')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            } else {
                console.log('Service Worker not supported in this environment');
            }
        }

        // Êó•‰ªòË°®Á§∫Êõ¥Êñ∞
        function updateDateDisplay() {
            const dateStr = formatDate(currentDate);
            document.getElementById('currentDate').textContent = dateStr;
        }

        // Êó•‰ªòÂ§âÊõ¥
        function changeDate(days) {
            // „Éï„Çß„Éº„Éâ„Ç¢„Ç¶„ÉàÂäπÊûú
            const mainContent = document.querySelector('.main-content');
            mainContent.style.opacity = '0.5';
            
            setTimeout(() => {
                currentDate.setDate(currentDate.getDate() + days);
                updateDateDisplay();
                loadCurrentDayData();
                updateSummary();
                updateDateStatus();
                
                // „Éï„Çß„Éº„Éâ„Ç§„É≥ÂäπÊûú
                mainContent.style.opacity = '1';
                
                // Êó•‰ªò„ÅåÂ§â„Çè„Å£„Åü„Åì„Å®„ÇíÁ§∫„Åô„Éï„É©„ÉÉ„Ç∑„É•ÂäπÊûú
                document.getElementById('currentDate').classList.add('date-changed');
                setTimeout(() => {
                    document.getElementById('currentDate').classList.remove('date-changed');
                }, 500);
            }, 150);
        }

        // Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatDate(date) {
            return date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
        }

        // Êó•‰ªò„Ç≠„ÉºÂèñÂæó
        function getDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // ÁèæÂú®„ÅÆÊó•‰ªò„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        function loadCurrentDayData() {
            const dateKey = getDateKey(currentDate);
            const dayData = appData[dateKey] || {
                fermented: [],
                fiber: 0,
                fiberDetail: {},
                plants: [],
                memo: '',
                insights: []
            };
            
            // „Åô„Åπ„Å¶„ÅÆÈ£üÁâ©ÁπäÁ∂≠„Ç´„Ç¶„É≥„Çø„Éº„ÇíÈùûË°®Á§∫„Å´„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.fiber-counter').forEach(counter => {
                counter.style.display = 'none';
            });
            
            // „Åô„Åπ„Å¶„ÅÆÈ£üÁâ©ÁπäÁ∂≠„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.fiber-quick-button').forEach(button => {
                button.classList.remove('selected');
            });
            
            updateFermentedDisplay(dayData.fermented);
            updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
            updatePlantsDisplay(dayData.plants);
            updateMemoDisplay(dayData.memo);
            updateInsightsDisplay(dayData.insights || []);
            updateDateStatus();
        }
        
        // Êó•‰ªò„ÅÆË®òÈå≤Áä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updateDateStatus() {
            const dateKey = getDateKey(currentDate);
            const dayData = appData[dateKey] || { fermented: [], fiber: 0, plants: [] };
            
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            if (!statusDot || !statusText) return;
            
            const hasFermented = dayData.fermented.length > 0;
            const hasFiber = dayData.fiber > 0;
            const hasPlants = dayData.plants.length > 0;
            
            const recordCount = [hasFermented, hasFiber, hasPlants].filter(Boolean).length;
            
            // „ÇØ„É©„Çπ„Çí„É™„Çª„ÉÉ„Éà
            statusDot.className = 'status-dot';
            
            if (recordCount === 0) {
                statusDot.classList.add('no-data');
                statusText.textContent = 'Êú™Ë®òÈå≤';
            } else if (recordCount === 3) {
                statusDot.classList.add('has-data');
                statusText.textContent = 'ÂÆåÂÖ®Ë®òÈå≤';
            } else {
                statusDot.classList.add('partial-data');
                statusText.textContent = `${recordCount}/3 Ë®òÈå≤Ê∏à„Åø`;
            }
        }

        // Áô∫ÈÖµÈ£üÂìÅ„Ç™„Éó„Ç∑„Éß„É≥ÂàùÊúüÂåñ
        function initializeFermentedOptions() {
            const container = document.getElementById('fermentedOptions');
            container.innerHTML = '';
            
            fermentedOptions.forEach(option => {
                const button = document.createElement('div');
                button.className = 'fermented-quick-button';
                button.setAttribute('data-name', option.name);
                button.setAttribute('title', option.description);
                button.onclick = () => toggleFermented(option.name);
                
                button.innerHTML = `
                    <div class="fermented-icon-large">${option.icon}</div>
                    <div class="fermented-name">${option.name}</div>
                    <div class="fermented-check">‚úì</div>
                `;
                container.appendChild(button);
            });
        }

        // Áô∫ÈÖµÈ£üÂìÅÈÅ∏ÊäûÂàá„ÇäÊõø„Åà
        function toggleFermented(option) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [] };
            }
            
            const fermented = appData[dateKey].fermented;
            const index = fermented.indexOf(option);
            
            if (index > -1) {
                fermented.splice(index, 1);
            } else {
                fermented.push(option);
            }
            
            updateFermentedDisplay(fermented);
            saveData();
            updateSummary();
        }

        // Áô∫ÈÖµÈ£üÂìÅË°®Á§∫Êõ¥Êñ∞
        function updateFermentedDisplay(selected) {
            // „Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.fermented-quick-button').forEach(button => {
                const name = button.getAttribute('data-name');
                if (selected.includes(name)) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
            
            // „Çµ„Éû„É™„Éº„ÅÆÊõ¥Êñ∞
            const selectedElement = document.getElementById('fermentedSelected');
            if (selectedElement) {
                selectedElement.textContent = selected.length;
            }
            
            // 2Á®ÆÈ°û‰ª•‰∏äÈÅ∏Êäû„ÅßÈÅîÊàê„É°„ÉÉ„Çª„Éº„Ç∏
            const summaryElement = document.getElementById('fermentedSummary');
            if (summaryElement && selected.length >= 2) {
                summaryElement.classList.add('achieved');
            } else if (summaryElement) {
                summaryElement.classList.remove('achieved');
            }
        }

        // È£üÁâ©ÁπäÁ∂≠„Ç´„ÉÜ„Ç¥„É™ÂàùÊúüÂåñ
        function initializeFiberCategories() {
            const container = document.getElementById('fiberCategories');
            container.innerHTML = '';
            
            // „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû„Éú„Çø„É≥„Ç∞„É™„ÉÉ„Éâ
            const quickGrid = document.createElement('div');
            quickGrid.className = 'fiber-quick-grid';
            
            fiberCategories.forEach(category => {
                const buttonWrapper = document.createElement('div');
                buttonWrapper.className = 'fiber-button-wrapper';
                
                buttonWrapper.innerHTML = `
                    <div class="fiber-quick-button" data-category="${category.name}" data-value="${category.value}">
                        <div class="fiber-icon">${getCategoryIcon(category.name)}</div>
                        <div class="fiber-name">${category.name}</div>
                        <div class="fiber-value">+${category.value}g</div>
                        <div class="fiber-unit">${category.unit}</div>
                    </div>
                    <div class="fiber-counter" style="display: none;">
                        <button class="counter-btn minus" onclick="adjustFiberAmount('${category.name}', -0.5)">‚àí</button>
                        <span class="counter-value" id="counter-${category.name}">1</span>
                        <button class="counter-btn plus" onclick="adjustFiberAmount('${category.name}', 0.5)">+</button>
                    </div>
                `;
                
                // „É°„Ç§„É≥„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                const mainButton = buttonWrapper.querySelector('.fiber-quick-button');
                mainButton.onclick = () => quickAddFiber(category.name, category.value);
                
                quickGrid.appendChild(buttonWrapper);
            });
            
            container.appendChild(quickGrid);
        }

        // „Ç´„ÉÜ„Ç¥„É™„Ç¢„Ç§„Ç≥„É≥ÂèñÂæóÈñ¢Êï∞
        function getCategoryIcon(categoryName) {
            const iconMap = {
                'ÁîüÈáéËèú„Çµ„É©„ÉÄ': 'ü•ó',
                'Ê∏©ÈáéËèú„ÉªÁÖÆÁâ©': 'üç≤',
                'ÈáéËèú„Çπ„Éº„Éó„ÉªÂë≥ÂôåÊ±Å': 'üçµ',
                'Êµ∑ËóªÈ°û': 'üåø',
                'ÁéÑÁ±≥„ÉªÈõëÁ©ÄÁ±≥': 'üçö',
                'Á¥çË±Ü': 'ü´ò',
                '„Åç„ÅÆ„ÅìÈ°û': 'üçÑ',
                'ÊûúÁâ©': 'üçé'
            };
            return iconMap[categoryName] || 'ü•¨';
        }

        // „ÇØ„Ç§„ÉÉ„ÇØËøΩÂä†Èñ¢Êï∞
        function quickAddFiber(categoryName, baseValue) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [], memo: '', insights: [] };
            }
            
            const dayData = appData[dateKey];
            const button = document.querySelector(`[data-category="${categoryName}"]`);
            const wrapper = button.closest('.fiber-button-wrapper');
            const counter = wrapper.querySelector('.fiber-counter');
            
            if (!dayData.fiberDetail[categoryName]) {
                // ÂàùÂõûÈÅ∏Êäû
                dayData.fiberDetail[categoryName] = {
                    count: 1,
                    unit: fiberCategories.find(c => c.name === categoryName).unit,
                    value: baseValue,
                    totalValue: baseValue
                };
                
                button.classList.add('selected');
                counter.style.display = 'flex';
                updateCounterDisplay(categoryName, 1);
            } else {
                // Êó¢„Å´ÈÅ∏ÊäûÊ∏à„Åø - 1ÁöøËøΩÂä†
                dayData.fiberDetail[categoryName].count += 1;
                dayData.fiberDetail[categoryName].totalValue += baseValue;
                
                updateCounterDisplay(categoryName, dayData.fiberDetail[categoryName].count);
            }
            
            // Á∑èÈáè„ÇíÂÜçË®àÁÆó
            dayData.fiber = Object.values(dayData.fiberDetail).reduce((sum, data) => sum + data.totalValue, 0);
            
            updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
            saveData();
            updateSummary();
        }

        // ÈáèË™øÊï¥Èñ¢Êï∞
        function adjustFiberAmount(categoryName, adjustment) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey] || !appData[dateKey].fiberDetail[categoryName]) return;
            
            const dayData = appData[dateKey];
            const detail = dayData.fiberDetail[categoryName];
            const baseValue = detail.value;
            
            // Êñ∞„Åó„ÅÑÈáè„ÇíË®àÁÆó
            const newCount = detail.count + adjustment;
            
            if (newCount <= 0) {
                // ÂâäÈô§Ôºà0.5„ÅÆÁä∂ÊÖã„Åã„Çâ„Äå-„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÇÇÂê´„ÇÄÔºâ
                delete dayData.fiberDetail[categoryName];
                
                const button = document.querySelector(`[data-category="${categoryName}"]`);
                const counter = button.closest('.fiber-button-wrapper').querySelector('.fiber-counter');
                button.classList.remove('selected');
                counter.style.display = 'none';
            } else {
                // Êõ¥Êñ∞ÔºàÊúÄÂ∞è0.5Ôºâ
                detail.count = Math.max(0.5, newCount);
                detail.totalValue = detail.count * baseValue;
                
                updateCounterDisplay(categoryName, detail.count);
            }
            
            // Á∑èÈáè„ÇíÂÜçË®àÁÆó
            dayData.fiber = Object.values(dayData.fiberDetail).reduce((sum, data) => sum + data.totalValue, 0);
            
            updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
            saveData();
            updateSummary();
        }

        function updateCounterDisplay(categoryName, count) {
            const counterElement = document.getElementById(`counter-${categoryName}`);
            if (counterElement) {
                counterElement.textContent = count % 1 === 0 ? count : count.toFixed(1);
            }
        }

        // È£üÁâ©ÁπäÁ∂≠Ë®òÈå≤ÂâäÈô§ÔºàÊñ∞„Åó„ÅÑUIÁî®Ôºâ
        function removeFiberRecord(categoryName) {
            const dateKey = getDateKey(currentDate);
            if (appData[dateKey] && appData[dateKey].fiberDetail[categoryName]) {
                const dayData = appData[dateKey];
                const data = dayData.fiberDetail[categoryName];
                
                // Êñ∞„Åó„ÅÑ„Éá„Éº„ÇøÊßãÈÄ†„ÅÆÂ†¥Âêà
                if (typeof data === 'object' && data.count !== undefined) {
                    // 1Âçò‰ΩçÂàÜ„ÇíÂâäÈô§
                    const unitValue = data.value;
                    data.count -= 1;
                    data.totalValue -= unitValue;
                    
                    // „Ç´„Ç¶„É≥„Éà„Åå0„Å´„Å™„Å£„Åü„ÇâÂâäÈô§
                    if (data.count <= 0) {
                        delete dayData.fiberDetail[categoryName];
                        
                        // „Éú„Çø„É≥„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíËß£Èô§
                        const button = document.querySelector(`[data-category="${categoryName}"]`);
                        const counter = button.closest('.fiber-button-wrapper').querySelector('.fiber-counter');
                        button.classList.remove('selected');
                        counter.style.display = 'none';
                    } else {
                        // „Ç´„Ç¶„É≥„Çø„ÉºË°®Á§∫„ÇíÊõ¥Êñ∞
                        updateCounterDisplay(categoryName, data.count);
                    }
                    
                    showMessage(`${categoryName}„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü (-${unitValue}g)`, 'success');
                } else {
                    // Âè§„ÅÑ„Éá„Éº„ÇøÊßãÈÄ†„ÅÆÂ†¥ÂêàÔºàÂæåÊñπ‰∫íÊèõÊÄßÔºâ
                    const category = fiberCategories.find(cat => cat.name === categoryName);
                    if (category) {
                        dayData.fiberDetail[categoryName]--;
                        
                        if (dayData.fiberDetail[categoryName] <= 0) {
                            delete dayData.fiberDetail[categoryName];
                        }
                        
                        showMessage(`${categoryName}„ÅÆË®òÈå≤„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü (-${category.value}g)`, 'success');
                    }
                }
                
                // Á∑èÈáè„ÇíÂÜçË®àÁÆó
                dayData.fiber = Object.values(dayData.fiberDetail).reduce((sum, data) => sum + data.totalValue, 0);
                
                // Ë°®Á§∫Êõ¥Êñ∞
                updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
                saveData();
                updateSummary();
            }
        }

        
        
        
        
        
        // „Ç´„Çπ„Çø„É†È£üÁâ©ÁπäÁ∂≠ËøΩÂä†
        function addCustomFiber() {
            const nameInput = document.getElementById('customFiberName');
            const amountInput = document.getElementById('customFiberAmount');
            const name = nameInput.value.trim();
            const amount = parseFloat(amountInput.value);

            if (!name || isNaN(amount) || amount <= 0) {
                showMessage('ÊúâÂäπ„Å™È£üÂìÅÂêç„Å®È£üÁâ©ÁπäÁ∂≠Èáè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [], memo: '', insights: [] };
            }
            const dayData = appData[dateKey];

            // „Ç´„Çπ„Çø„É†È†ÖÁõÆ„Å®„Åó„Å¶‰øùÂ≠ò
            dayData.fiberDetail[`custom-${name}`] = {
                count: 1,
                unit: '„Ç´„Çπ„Çø„É†',
                value: amount,
                totalValue: amount
            };

            // ÂêàË®àÂÄ§„ÇíÂÜçË®àÁÆó
            dayData.fiber = Object.values(dayData.fiberDetail).reduce((sum, item) => sum + item.totalValue, 0);

            updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
            saveData();
            updateSummary();

            // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
            nameInput.value = '';
            amountInput.value = '';
        }

        function removeFiberItem(itemName) {
            const dateKey = getDateKey(currentDate);
            const dayData = appData[dateKey];

            if (dayData && dayData.fiberDetail[itemName]) {
                delete dayData.fiberDetail[itemName];
                // ÂêàË®àÂÄ§„ÇíÂÜçË®àÁÆó
                dayData.fiber = Object.values(dayData.fiberDetail).reduce((sum, item) => sum + item.totalValue, 0);
                
                updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
                saveData();
                updateSummary();
            }
        }
        
        // È£üÁâ©ÁπäÁ∂≠ËøΩÂä†
        function addFiber(categoryName, totalValue, amount, unit) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [] };
            }
            
            const dayData = appData[dateKey];
            dayData.fiber += totalValue;
            
            // Êó¢Â≠ò„ÅÆË®òÈå≤„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂêàË®à
            if (dayData.fiberDetail[categoryName]) {
                dayData.fiberDetail[categoryName].count += amount;
                dayData.fiberDetail[categoryName].totalValue += totalValue;
            } else {
                dayData.fiberDetail[categoryName] = {
                    count: amount,
                    unit: unit,
                    value: totalValue / amount, // 1Âçò‰Ωç„ÅÇ„Åü„Çä„ÅÆÂÄ§
                    totalValue: totalValue
                };
            }
            
            updateFiberDisplay(dayData.fiber, dayData.fiberDetail);
            saveData();
            updateSummary();
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            showMessage(`${categoryName} ${amount}${unit.split('(')[0]}„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü (+${totalValue}g)`, 'success');
        }

        // È£üÁâ©ÁπäÁ∂≠Ë°®Á§∫Êõ¥Êñ∞
        function updateFiberDisplay(total, detail) {
            // „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû„Éú„Çø„É≥„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            document.querySelectorAll('#fiberCategories .fiber-quick-button').forEach(button => {
                const categoryName = button.dataset.category;
                button.classList.toggle('selected', !!detail[categoryName]);
            });

            // „Ç´„Çπ„Çø„É†È£üÂìÅ„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
            const customList = document.getElementById('customFiberList');
            if (customList) {
                customList.innerHTML = '';
                Object.entries(detail).forEach(([name, data]) => {
                    if (name.startsWith('custom-')) {
                        const displayName = name.replace('custom-', '');
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'custom-fiber-item';
                        itemDiv.innerHTML = `
                            <span>${displayName}</span>
                            <span>+${data.totalValue}g</span>
                            <button class="remove-custom-btn" onclick="removeFiberItem('${name}')">√ó</button>
                        `;
                        customList.appendChild(itemDiv);
                    }
                });
            }

            // „Çµ„Éû„É™„Éº„Å®„Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„ÇíÊõ¥Êñ∞
            const fiberTotalElement = document.getElementById('fiberTotal');
            const fiberGoalElement = document.getElementById('fiberGoal');
            const fiberRemainingElement = document.getElementById('fiberRemaining');
            const fiberProgressBarElement = document.getElementById('fiberProgressBar');

            if (fiberTotalElement) {
                fiberTotalElement.textContent = total.toFixed(1);
            }
            if (fiberGoalElement) {
                fiberGoalElement.textContent = settings.fiberGoal;
            }
            
            const remaining = Math.max(0, settings.fiberGoal - total);
            if (fiberRemainingElement) {
                fiberRemainingElement.textContent = remaining.toFixed(1);
            }
            
            const progress = Math.min(100, (total / settings.fiberGoal) * 100);
            if (fiberProgressBarElement) {
                fiberProgressBarElement.style.width = progress + '%';
            }
            
            // Ë©≥Á¥∞Ë®òÈå≤„ÅÆË°®Á§∫Êõ¥Êñ∞
            updateFiberDetails(detail);
        }
        
        // È£üÁâ©ÁπäÁ∂≠Ë©≥Á¥∞Ë°®Á§∫Êõ¥Êñ∞
        function updateFiberDetails(detail) {
            const container = document.getElementById('fiberDetails');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Ë®òÈå≤„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ‰Ωï„ÇÇË°®Á§∫„Åó„Å™„ÅÑ
            if (Object.keys(detail).length === 0) {
                return;
            }
            
            // ÂêÑ„Ç´„ÉÜ„Ç¥„É™„ÅÆË®òÈå≤„ÇíË°®Á§∫
            Object.entries(detail).forEach(([categoryName, data]) => {
                if (data && data.count > 0) {
                    const div = document.createElement('div');
                    div.className = 'fiber-record-item';
                    
                    // Êñ∞„Åó„ÅÑ„Éá„Éº„ÇøÊßãÈÄ†„ÅÆÂ†¥Âêà
                    if (typeof data === 'object' && data.count !== undefined) {
                        // „Ç´„ÉÜ„Ç¥„É™„Å´Âøú„Åò„ÅüÈÅ©Âàá„Å™Âçò‰Ωç„ÇíÂèñÂæó
                        const getDisplayUnit = (categoryName, count) => {
                            if (categoryName === 'ÁéÑÁ±≥„ÉªÈõëÁ©ÄÁ±≥') {
                                return `Ëå∂Á¢ó${count}ËÜ≥`;
                            }
                            
                            const unitMap = {
                                'ÁîüÈáéËèú„Çµ„É©„ÉÄ': 'Áöø',
                                'Ê∏©ÈáéËèú„ÉªÁÖÆÁâ©': 'Áöø',
                                'ÈáéËèú„Çπ„Éº„Éó„ÉªÂë≥ÂôåÊ±Å': 'ÊùØ',
                                'Êµ∑ËóªÈ°û': 'Áöø',
                                'Á¥çË±Ü': '„Éë„ÉÉ„ÇØ',
                                '„Åç„ÅÆ„ÅìÈ°û': 'Áöø',
                                'ÊûúÁâ©': 'ÂÄã'
                            };
                            return unitMap[categoryName] || 'ÂÄã';
                        };
                        
                        const count = Math.round(data.count * 2) / 2; // 0.5Âàª„Åø„Åß‰∏∏„ÇÅ„Çã
                        const displayUnit = getDisplayUnit(categoryName, count);
                        div.innerHTML = `
                            <div class="fiber-record-info">
                                <div class="fiber-record-name">${categoryName}</div>
                                <div class="fiber-record-value">
                                    ${count}${displayUnit} √ó ${data.value}g = ${data.totalValue.toFixed(1)}g
                                </div>
                            </div>
                            <button class="remove-fiber-btn" onclick="removeFiberRecord('${categoryName}')">ÂâäÈô§</button>
                        `;
                    } else {
                        // Âè§„ÅÑ„Éá„Éº„ÇøÊßãÈÄ†„ÅÆÂ†¥ÂêàÔºàÂæåÊñπ‰∫íÊèõÊÄßÔºâ
                        const category = fiberCategories.find(cat => cat.name === categoryName);
                        if (category) {
                            const totalValue = category.value * data;
                            div.innerHTML = `
                                <div class="fiber-record-info">
                                    <div class="fiber-record-name">${categoryName}</div>
                                    <div class="fiber-record-value">${data}Âõû √ó ${category.value}g = ${totalValue}g</div>
                                </div>
                                <button class="remove-fiber-btn" onclick="removeFiberRecord('${categoryName}')">ÂâäÈô§</button>
                            `;
                        }
                    }
                    container.appendChild(div);
                }
            });
        }

        // Ê§çÁâ©ËøΩÂä†
        function addPlant() {
            const input = document.getElementById('plantInput');
            if (!input) return;
            
            const plantName = input.value.trim();
            
            if (!plantName) {
                showMessage('Ê§çÁâ©Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }
            
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [] };
            }
            
            const plants = appData[dateKey].plants;
            if (plants.includes(plantName)) {
                showMessage('„Åì„ÅÆÊ§çÁâ©„ÅØ‰ªäÊó•Êó¢„Å´Ë®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô', 'error');
                return;
            }
            
            // ‰ªäÈÄ±Êó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const weekPlants = getWeeklyPlants();
            const isWeeklyDuplicate = weekPlants.includes(plantName);
            
            plants.push(plantName);
            input.value = '';
            
            updatePlantsDisplay(plants);
            saveData();
            updateSummary();
            
            if (isWeeklyDuplicate) {
                showMessage(`${plantName}„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºà‰ªäÈÄ±2ÂõûÁõÆ„ÅÆÁôªÈå≤„Åß„ÅôÔºâ`, 'success');
            } else {
                showMessage(`${plantName}„ÇíËøΩÂä†„Åó„Åæ„Åó„ÅüÔºà‰ªäÈÄ±ÂàùÂõûÁôªÈå≤Ôºâ`, 'success');
            }
        }


        // Ê§çÁâ©ÂâäÈô§
        function removePlant(plantName) {
            const dateKey = getDateKey(currentDate);
            if (appData[dateKey]) {
                const plants = appData[dateKey].plants;
                const index = plants.indexOf(plantName);
                if (index > -1) {
                    plants.splice(index, 1);
                    updatePlantsDisplay(plants);
                    saveData();
                    updateSummary();
                }
            }
        }

        // „É°„É¢Ë°®Á§∫Êõ¥Êñ∞
        function updateMemoDisplay(memo) {
            const memoTextarea = document.getElementById('memoTextarea');
            if (memoTextarea) {
                memoTextarea.value = memo || '';
            }
        }

        // „É°„É¢‰øùÂ≠ò
        function saveMemo(memoText) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { fermented: [], fiber: 0, fiberDetail: {}, plants: [], memo: '', insights: [] };
            }
            
            appData[dateKey].memo = memoText;
            saveData();
        }

        // Ê∞ó„Å•„Åç„Çø„Ç∞ÂàùÊúüÂåñ
        function initializeInsightTags() {
            const container = document.getElementById('insightsGrid');
            if (!container) return;
            
            container.innerHTML = '';
            
            insightTags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'insight-tag';
                tagElement.setAttribute('data-id', tag.id);
                tagElement.onclick = () => toggleInsight(tag.id);
                
                tagElement.innerHTML = `
                    <div class="insight-icon">${tag.icon}</div>
                    <div class="insight-label">${tag.label}</div>
                `;
                
                container.appendChild(tagElement);
            });
        }

        // „Çø„Ç∞ÈÅ∏ÊäûÂàá„ÇäÊõø„Åà
        function toggleInsight(tagId) {
            const dateKey = getDateKey(currentDate);
            if (!appData[dateKey]) {
                appData[dateKey] = { 
                    fermented: [], 
                    fiber: 0, 
                    fiberDetail: {}, 
                    plants: [],
                    memo: '',
                    insights: []
                };
            }
            
            const insights = appData[dateKey].insights || [];
            const index = insights.indexOf(tagId);
            
            if (index > -1) {
                insights.splice(index, 1);
            } else {
                insights.push(tagId);
            }
            
            appData[dateKey].insights = insights;
            updateInsightsDisplay(insights);
            saveData();
        }

        // Ê∞ó„Å•„ÅçË°®Á§∫Êõ¥Êñ∞
        function updateInsightsDisplay(selectedIds) {
            // „Çø„Ç∞„ÅÆÈÅ∏ÊäûÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            document.querySelectorAll('.insight-tag').forEach(tag => {
                const tagId = tag.getAttribute('data-id');
                if (selectedIds.includes(tagId)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });
            
            // „Çµ„Éû„É™„ÉºÊõ¥Êñ∞
            const summaryElement = document.getElementById('insightsSummary');
            if (summaryElement) {
                const count = selectedIds.length;
                summaryElement.textContent = count > 0 
                    ? `${count}ÂÄã„ÅÆÊ∞ó„Å•„Åç„ÇíË®òÈå≤„Åó„Åæ„Åó„Åü` 
                    : '‰ªäÊó•„ÅÆÈ£ü‰∫ã„ÇÑ‰ΩìË™ø„ÅÆÁâπÂæ¥„Çí„Çø„ÉÉ„Éó„Åó„Å¶Ë®òÈå≤';
            }
        }


        // Ê§çÁâ©ÈÅ∏Êäû
        function selectPlant(plantName) {
            const plantInput = document.getElementById('plantInput');
            if (plantInput) {
                plantInput.value = plantName;
            hidePlantSuggestions();
            addPlant();
            }
        }

        // Ê§çÁâ©ÂÄôË£úË°®Á§∫
        function showPlantSuggestions(query) {
            const suggestionsContainer = document.getElementById('plantSuggestions');
            if (!suggestionsContainer) return;
            
            suggestionsContainer.innerHTML = '';
            
            if (query.length < 1) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            const allPlants = [];
            Object.values(plantDatabase).forEach(subcategories => {
                allPlants.push(...Object.values(subcategories).flat());
            });
            
            const matches = allPlants.filter(plant => 
                plant.toLowerCase().includes(query.toLowerCase())
            ).slice(0, 8); // ÊúÄÂ§ß8‰ª∂„Åæ„ÅßË°®Á§∫
            
            if (matches.length > 0) {
                matches.forEach(plant => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'plant-suggestion-item';
                    itemDiv.textContent = plant;
                    itemDiv.onclick = () => selectPlant(plant);
                    suggestionsContainer.appendChild(itemDiv);
                });
                suggestionsContainer.style.display = 'block';
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        // Ê§çÁâ©ÂÄôË£úÈùûË°®Á§∫
        function hidePlantSuggestions() {
            const suggestions = document.getElementById('plantSuggestions');
            if (suggestions) {
                suggestions.style.display = 'none';
            }
        }

        // Ê§çÁâ©Ë°®Á§∫Êõ¥Êñ∞
        function updatePlantsDisplay(plants) {
            const container = document.getElementById('plantsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            plants.forEach(plant => {
                const div = document.createElement('div');
                div.className = 'plant-item';
                div.innerHTML = `
                    <span class="plant-name">${plant}</span>
                    <button class="remove-plant-btn" onclick="removePlant('${plant}')">ÂâäÈô§</button>
                `;
                container.appendChild(div);
            });
            
            // ÈÄ±Ê¨°ÈÄ≤ÊçóÊõ¥Êñ∞
            updateWeeklyProgress();
        }

        // ÈÄ±Ê¨°ÈÄ≤ÊçóÊõ¥Êñ∞
        function updateWeeklyProgress() {
            const weekPlants = getWeeklyPlants();
            const uniquePlants = [...new Set(weekPlants)];
            const count = uniquePlants.length;
            
            const weeklyPlantCountElement = document.getElementById('weeklyPlantCount');
            if (weeklyPlantCountElement) {
                weeklyPlantCountElement.textContent = count;
            }
            
            const progress = Math.min(100, (count / 30) * 100);
            const weeklyPlantProgressElement = document.getElementById('weeklyPlantProgress');
            if (weeklyPlantProgressElement) {
                weeklyPlantProgressElement.style.width = progress + '%';
            }
            
            // ‰ªäÈÄ±„ÅÆÊ§çÁâ©‰∏ÄË¶ß„ÇíÊõ¥Êñ∞
            updateWeeklyPlantsList(weekPlants, uniquePlants);
        }
        
        // ‰ªäÈÄ±„ÅÆÊ§çÁâ©‰∏ÄË¶ßË°®Á§∫Êõ¥Êñ∞
        function updateWeeklyPlantsList(weekPlants, uniquePlants) {
            const container = document.getElementById('weeklyPlantsList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (uniquePlants.length === 0) {
                return;
            }
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'weekly-plants-title';
            titleDiv.textContent = '‰ªäÈÄ±ÁôªÈå≤Ê∏à„Åø„ÅÆÊ§çÁâ©Á®ÆÈ°û';
            container.appendChild(titleDiv);
            
            const gridDiv = document.createElement('div');
            gridDiv.className = 'weekly-plants-grid';
            
            // Ê§çÁâ©„ÅÆÂá∫ÁèæÂõûÊï∞„Çí„Ç´„Ç¶„É≥„Éà
            const plantCounts = {};
            weekPlants.forEach(plant => {
                plantCounts[plant] = (plantCounts[plant] || 0) + 1;
            });
            
            // „É¶„Éã„Éº„ÇØ„Å™Ê§çÁâ©„Çí„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„ÉàÈ†Ü„Å´„ÇΩ„Éº„Éà
            uniquePlants.sort().forEach(plant => {
                const plantTag = document.createElement('div');
                plantTag.className = 'weekly-plant-tag';
                
                const count = plantCounts[plant];
                if (count > 1) {
                    plantTag.classList.add('duplicate');
                    plantTag.textContent = `${plant} (${count}Âõû)`;
                } else {
                    plantTag.textContent = plant;
                }
                
                gridDiv.appendChild(plantTag);
            });
            
            container.appendChild(gridDiv);
        }

        // ÈÄ±Ê¨°Ê§çÁâ©„Éá„Éº„ÇøÂèñÂæó
        function getWeeklyPlants() {
            const today = new Date(currentDate);
            const monday = new Date(today);
            
            // Êó•ÊõúÊó•„ÅÆÂ†¥Âêà„ÅÆ‰øÆÊ≠£Ôºà0„ÅÆÂ†¥Âêà„ÅØ7„Å´„Åô„ÇãÔºâ
            const dayOfWeek = today.getDay() === 0 ? 7 : today.getDay();
            monday.setDate(today.getDate() - dayOfWeek + 1);
            
            const weekPlants = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(monday);
                date.setDate(monday.getDate() + i);
                const dateKey = getDateKey(date);
                if (appData[dateKey] && appData[dateKey].plants) {
                    weekPlants.push(...appData[dateKey].plants);
                }
            }
            
            return weekPlants;
        }

        // „Çµ„Éû„É™„ÉºÊõ¥Êñ∞
        function updateSummary() {
            const dateKey = getDateKey(currentDate);
            const dayData = appData[dateKey] || { fermented: [], fiber: 0, plants: [] };
            
            document.getElementById('fermentedCount').textContent = dayData.fermented.length;
            document.getElementById('fiberCount').textContent = dayData.fiber + 'g';
            document.getElementById('plantCount').textContent = dayData.plants.length;
            
            // Êó•‰ªòÁä∂ÊÖã„ÇÇÊõ¥Êñ∞
            updateDateStatus();
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥Âàá„ÇäÊõø„Åà
        function toggleSection(sectionName) {
            const content = document.getElementById(sectionName + 'Content');
            const toggle = document.getElementById(sectionName + 'Toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
            }
        }

        // „Éö„Éº„Ç∏Âàá„ÇäÊõø„Åà
        function showPage(page) {
            currentPage = page;
            
            // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Êõ¥Êñ∞
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥È†ÖÁõÆ„ÇíË®≠ÂÆö
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.onclick && item.onclick.toString().includes(`'${page}'`)) {
                    item.classList.add('active');
                }
            });
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑÊõ¥Êñ∞
            const mainContent = document.getElementById('mainContent');
            
            switch(page) {
                case 'main':
                    mainContent.innerHTML = getMainContent();
                    initializeApp();
                    break;
                case 'biweekly':
                    biweeklyOffset = 0; // „Éö„Éº„Ç∏„ÇíÈñã„Åè„Å®„Åç„ÅØÂ∏∏„Å´‰ªäÈÄ±Âü∫Ê∫ñ„Å´Êàª„Åô
                    mainContent.innerHTML = getBiweeklyReport();
                    loadBiweeklyReport();
                    break;
                case 'calendar':
                    mainContent.innerHTML = getCalendarPage();
                    loadCalendarPage();
                    break;
                case 'settings':
                    mainContent.innerHTML = getSettingsPage();
                    loadSettingsPage();
                    break;
            }
        }

        // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑÂèñÂæó
        function getMainContent() {
            return `
                <!-- Áô∫ÈÖµÈ£üÂìÅË®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('fermented')">
                        <div class="section-title">Áô∫ÈÖµÈ£üÂìÅË®òÈå≤</div>
                        <div class="section-toggle" id="fermentedToggle">‚ñº</div>
                    </div>
                    <div class="section-content" id="fermentedContent">
                        <div class="fermented-options" id="fermentedOptions">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                        <div class="fermented-summary" id="fermentedSummary">
                            ‰ªäÊó•„ÅØ <span id="fermentedSelected">0</span> Á®ÆÈ°û„ÅÆÁô∫ÈÖµÈ£üÂìÅ„ÇíÈ£ü„Åπ„Åæ„Åó„Åü
                            <br>
                            <small>ÁõÆÊ®ô: 1Êó•2Á®ÆÈ°û‰ª•‰∏ä</small>
                        </div>
                    </div>
                </div>

                <!-- È£üÁâ©ÁπäÁ∂≠Ë®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('fiber')">
                        <div class="section-title">È£üÁâ©ÁπäÁ∂≠Ë®òÈå≤</div>
                        <div class="section-toggle" id="fiberToggle">‚ñº</div>
                    </div>
                    <div class="section-content" id="fiberContent">
                        <div class="fiber-categories" id="fiberCategories">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                        <div class="fiber-details" id="fiberDetails">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„ÇãË®òÈå≤Ë©≥Á¥∞ -->
                        </div>
                        <div class="fiber-summary" id="fiberSummary">
                            <div>‰ªäÊó•„ÅÆÈ£üÁâ©ÁπäÁ∂≠: <span id="fiberTotal">0</span>g / <span id="fiberGoal">18</span>g</div>
                            <div class="fiber-progress">
                                <div class="fiber-progress-bar" id="fiberProgressBar" style="width: 0%"></div>
                            </div>
                            <small>ÁõÆÊ®ôÈÅîÊàê„Åæ„Åß <span id="fiberRemaining">18</span>g</small>
                        </div>
                    </div>
                </div>

                <!-- È£üÂìÅÂ§öÊßòÊÄßË®òÈå≤„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('plants')">
                        <div class="section-title">È£üÂìÅÂ§öÊßòÊÄßË®òÈå≤</div>
                        <div class="section-toggle" id="plantsToggle">‚ñº</div>
                    </div>
                    <div class="section-content" id="plantsContent">
                        <div class="plant-input-container">
                            <div class="plant-input-wrapper">
                                <input type="text" class="plant-input" id="plantInput" placeholder="Ê§çÁâ©Âêç„ÇíÂÖ•ÂäõÔºà‰æã: „Éà„Éû„ÉàÔºâ" autocomplete="off">
                                <div class="plant-suggestions" id="plantSuggestions"></div>
                            </div>
                            <button class="add-plant-btn" onclick="addPlant()">ËøΩÂä†</button>
                        </div>
                        <div class="plants-list" id="plantsList">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                        <div class="weekly-plants-list" id="weeklyPlantsList">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã‰ªäÈÄ±„ÅÆÊ§çÁâ©‰∏ÄË¶ß -->
                        </div>
                        <div class="diversity-progress">
                            <div>‰ªäÈÄ±„ÅÆÊ§çÁâ©Á®ÆÈ°û: <span id="weeklyPlantCount">0</span> / 30Á®ÆÈ°û</div>
                            <div class="progress-bar">
                                <div class="progress-bar-fill" id="weeklyPlantProgress" style="width: 0%"></div>
                            </div>
                            <small>ÁõÆÊ®ô: ÈÄ±30Á®ÆÈ°û</small>
                        </div>
                    </div>
                </div>

                <!-- ‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('insights')">
                        <div class="section-title">üí° ‰ªäÊó•„ÅÆÊ∞ó„Å•„Åç</div>
                        <div class="section-toggle" id="insightsToggle">‚ñº</div>
                    </div>
                    <div class="section-content" id="insightsContent">
                        <div class="insights-grid" id="insightsGrid">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                        </div>
                        <div class="insights-summary" id="insightsSummary">
                            <!-- ÈÅ∏Êäû„Åï„Çå„Åü„Çø„Ç∞Êï∞„ÇíË°®Á§∫ -->
                        </div>
                        </div>
                        </div>

                <!-- „É°„É¢„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="section-card">
                    <div class="section-header" onclick="toggleSection('memo')">
                        <div class="section-title">üìù „É°„É¢</div>
                        <div class="section-toggle" id="memoToggle">‚ñº</div>
                    </div>
                    <div class="section-content" id="memoContent">
                        <textarea id="memoTextarea" class="memo-textarea" placeholder="‰ªäÊó•„ÅÆÈ£ü‰∫ã„ÇÑ‰ΩìË™ø„ÄÅÊ∞ó„Å•„ÅÑ„Åü„Åì„Å®„ÇíËá™Áî±„Å´„É°„É¢„Åß„Åç„Åæ„Åô"></textarea>
                        <div class="memo-save-info">
                            <small>‚úì ÂÖ•ÂäõÂÜÖÂÆπ„ÅØËá™Âãï‰øùÂ≠ò„Åï„Çå„Åæ„Åô</small>
                        </div>
                    </div>
                </div>
            `;
        }

        // 2ÈÄ±Èñì„É¨„Éù„Éº„ÉàÂèñÂæó
        function getBiweeklyReport() {
            return `
                <div class="report-section">
                    <div class="report-title-container">
                        <div class="report-title">2ÈÄ±Èñì„É¨„Éù„Éº„Éà</div>
                        <button class="why-button" onclick="showBiweeklyInfo()" title="„Å™„Åú2ÈÄ±ÈñìÔºü">i</button>
                    </div>
                    
                    <div class="biweekly-nav">
                        <button class="biweekly-nav-btn" onclick="changeBiweeklyPeriod(-1)">‚óÄ Ââç„ÅÆ2ÈÄ±Èñì</button>
                        <div id="biweeklyPeriod" class="biweekly-period-text">‰ªäÈÄ±Âü∫Ê∫ñ</div>
                        <button class="biweekly-nav-btn" onclick="changeBiweeklyPeriod(1)" id="nextBiweeklyBtn">Ê¨°„ÅÆ2ÈÄ±Èñì ‚ñ∂</button>
                    </div>
                    
                    <div class="plant-goal-status" id="plantGoalStatus">
                    </div>

                    <div class="chart-container">
                        <canvas id="biweeklyChart"></canvas>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="biweeklyFermentedAvg">0</div>
                            <div class="stat-label">Áô∫ÈÖµÈ£üÂìÅ/Êó• (Âπ≥Âùá)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="biweeklyFiberAvg">0g</div>
                            <div class="stat-label">È£üÁâ©ÁπäÁ∂≠/Êó• (Âπ≥Âùá)</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Éö„Éº„Ç∏ÂèñÂæó
        function getCalendarPage() {
            return `
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button onclick="changeCalendarMonth(-1)">‚óÄ</button>
                        <h3 id="calendarTitle">${calendarYear}Âπ¥${calendarMonth + 1}Êúà</h3>
                        <button onclick="changeCalendarMonth(1)">‚ñ∂</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
                    </div>
                    <div class="calendar-legend">
                        <div class="legend-title">Ëä±„Å≥„Çâ„ÅÆË¶ãÊñπ</div>
                        <div class="legend-items" style="display:flex;flex-direction:column;gap:8px;">
                            <div class="legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span style="display:inline-block;width:12px;height:12px;background:#D2691E;border-radius:50% 0;"></span>
                                <span>Áô∫ÈÖµÈ£üÂìÅÔºà‰∏äÔºâ</span>
                        </div>
                            <div class="legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span style="display:inline-block;width:12px;height:12px;background:#FF9800;border-radius:50% 0;transform:rotate(120deg);"></span>
                                <span>È£üÁâ©ÁπäÁ∂≠ÔºàÂè≥‰∏ãÔºâ</span>
                        </div>
                            <div class="legend-item" style="display:flex;align-items:center;gap:8px;">
                                <span style="display:inline-block;width:12px;height:12px;background:#4CAF50;border-radius:50% 0;transform:rotate(240deg);"></span>
                                <span>Ê§çÁâ©Á®ÆÈ°ûÔºàÂ∑¶‰∏ãÔºâ</span>
                            </div>
                        </div>
                        <div style="margin-top:10px;font-size:11px;color:#888;">
                            Ëä±„Å≥„Çâ„ÅÆÊøÉ„ÅïÔºöËñÑ„ÅÑ = ÁõÆÊ®ôÊú™ÈÅîÊàê„ÄÅÊøÉ„ÅÑ = ÁõÆÊ®ôÈÅîÊàê<br>
                            Ëä±„Å≥„Çâ„Å™„Åó = „Åù„ÅÆÈ†ÖÁõÆ„ÅÆË®òÈå≤„Å™„Åó<br>
                            <span style="display:inline-block;width:12px;height:12px;background:linear-gradient(135deg,#fff 50%,#FFF3E0 50%);border:1px solid #ddd;"></span> Ê∞ó„Å•„Åç„ÅÇ„Çä
                            <span style="display:inline-block;width:12px;height:12px;background:linear-gradient(135deg,#fff 50%,#FFE5E5 50%);border:1px solid #ddd;margin-left:8px;"></span> ÈáçË¶Å„Å™Ê∞ó„Å•„Åç„ÅÇ„Çä
                        </div>
                    </div>
                </div>
            `;
        }

        // Ë®≠ÂÆöÁîªÈù¢ÂèñÂæó
        function getSettingsPage() {
            return `
                <div class="settings-section">
                    <div class="settings-title">Âü∫Êú¨Ë®≠ÂÆö</div>
                    <div class="setting-item">
                        <div class="setting-label">ÊÄßÂà•</div>
                        <div class="gender-options">
                            <div class="gender-option" id="gender-female" onclick="setGender('female')">Â•≥ÊÄß</div>
                            <div class="gender-option" id="gender-male" onclick="setGender('male')">Áî∑ÊÄß</div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">È£üÁâ©ÁπäÁ∂≠ÁõÆÊ®ôÂÄ§</div>
                        <div class="fiber-goal-container">
                            <input type="number" class="fiber-goal-input" id="fiberGoalInput" min="10" max="50" step="1">
                            <span class="fiber-goal-unit">g/Êó•</span>
                        </div>
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; color: #666;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #333;">È£üÁâ©ÁπäÁ∂≠„ÅÆÁõÆÂÆâ</div>
                            <div style="margin-bottom: 6px;">
                                <strong>ÁõÆÊ®ôÈáè</strong><br>
                                Â•≥ÊÄß: 18gÔºèÁî∑ÊÄß: 22g<br>
                                <span style="font-size: 11px;">‚Üí 1Êó•„ÅÆÂÅ•Â∫∑Á∂≠ÊåÅ„Å´ÂøÖË¶Å„Å™ÊúÄ‰ΩéÈôê„ÅÆÁõÆÂÆâ</span>
                            </div>
                            <div>
                                <strong>Êé®Â•®Èáè</strong><br>
                                25g<br>
                                <span style="font-size: 11px;">‚Üí „Çà„ÇäÂÅ•Â∫∑ÁöÑ„Å™ÁîüÊ¥ª„ÅÆ„Åü„ÇÅ„Å´Êúõ„Åæ„Åó„ÅÑÈáè</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">„Éá„Éº„ÇøÁÆ°ÁêÜ</div>
                    <div class="setting-item">
                        <button class="add-plant-btn" onclick="resetAllData()" style="background: #dc3545; width: 100%;">
                            „Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà
                        </button>
                    </div>
                </div>
            `;
        }

        // 2ÈÄ±Èñì„É¨„Éù„Éº„ÉàË™≠„ÅøËæº„Åø
        function loadBiweeklyReport() {
            try {
                const biweeklyData = getBiweeklyData();
                if (biweeklyData && biweeklyData.length > 0) {
                    updateBiweeklyStats(biweeklyData);
                    // „ÉÅ„É£„Éº„Éà‰ΩúÊàê„ÇíÈÅÖÂª∂ÂÆüË°åÔºàDOMË¶ÅÁ¥†„ÅåÁ¢∫ÂÆü„Å´Â≠òÂú®„Åô„Çã„Çà„ÅÜ„Å´Ôºâ
                    setTimeout(() => {
                        createBiweeklyChart(biweeklyData);
                    }, 100);
                } else {
                    console.error('2ÈÄ±Èñì„Éá„Éº„Çø„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    showMessage('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                }
            } catch (error) {
                console.error('2ÈÄ±Èñì„É¨„Éù„Éº„ÉàË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                showMessage('„É¨„Éù„Éº„Éà„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }
        
        function getBiweeklyData() {
            try {
                const today = new Date(currentDate);
                const dayOfWeek = today.getDay() === 0 ? 6 : today.getDay() - 1; // ÊúàÊõú=0, Êó•Êõú=6
                const baseMonday = new Date(today);
                baseMonday.setDate(today.getDate() - dayOfWeek);
                
                // „Ç™„Éï„Çª„ÉÉ„Éà„ÇíÈÅ©Áî®Ôºà14Êó•Âçò‰Ωç„ÅßÁßªÂãïÔºâ
                baseMonday.setDate(baseMonday.getDate() + (biweeklyOffset * 14));

                const biweeklyData = [];
                // 14Êó•Ââç„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæó
                for (let i = -13; i <= 0; i++) {
                    const date = new Date(baseMonday);
                    date.setDate(baseMonday.getDate() + i);
                    const dateKey = getDateKey(date);
                    const dayData = appData[dateKey] || { fermented: [], fiber: 0, plants: [] };
                    
                    biweeklyData.push({
                        date: date,
                        dateStr: date.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' }),
                        fermented: dayData.fermented ? dayData.fermented.length : 0,
                        fiber: dayData.fiber || 0,
                        plants: dayData.plants || []
                    });
                }
                return biweeklyData;
            } catch (error) {
                console.error('2ÈÄ±Èñì„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
                return [];
            }
        }

        function updateBiweeklyStats(biweeklyData) {
            try {
                if (!biweeklyData || biweeklyData.length === 0) {
                    console.error('2ÈÄ±Èñì„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô');
                    return;
                }
                
                // Áµ±Ë®àË®àÁÆó
                const fermentedTotal = biweeklyData.reduce((sum, day) => sum + day.fermented, 0);
                const fiberTotal = biweeklyData.reduce((sum, day) => sum + day.fiber, 0);
                
                const fermentedAvgElement = document.getElementById('biweeklyFermentedAvg');
                const fiberAvgElement = document.getElementById('biweeklyFiberAvg');
                
                if (fermentedAvgElement) {
                    fermentedAvgElement.textContent = (fermentedTotal / 14).toFixed(1);
                }
                if (fiberAvgElement) {
                    fiberAvgElement.textContent = (fiberTotal / 14).toFixed(1) + 'g';
                }

                // Ê§çÁâ©Â§öÊßòÊÄß„Ç¥„Éº„É´„ÅÆÈÅîÊàêÁä∂Ê≥Å
                const week1_plants = biweeklyData.slice(0, 7).flatMap(d => d.plants || []);
                const week2_plants = biweeklyData.slice(7, 14).flatMap(d => d.plants || []);
                
                const week1_unique_count = new Set(week1_plants).size;
                const week2_unique_count = new Set(week2_plants).size;

                const week1_achieved = week1_unique_count >= 30;
                const week2_achieved = week2_unique_count >= 30;
                
                // ÈÄ±„ÅÆË°®Áèæ„ÇíË®àÁÆóÔºàoffset=0„Å™„Çâ„ÄåÂÖàÈÄ±„Äç„Äå‰ªäÈÄ±„Äç„ÄÅoffset=-1„Å™„Çâ„Äå3ÈÄ±ÈñìÂâç„Äç„Äå2ÈÄ±ÈñìÂâç„Äç„Å™„Å©Ôºâ
                let week1Label, week2Label;
                
                if (biweeklyOffset === 0) {
                    week1Label = 'ÂÖàÈÄ±';
                    week2Label = '‰ªäÈÄ±';
                } else {
                    // offset=-1„ÅÆÂ†¥Âêà: week1=3ÈÄ±ÈñìÂâç„ÄÅweek2=2ÈÄ±ÈñìÂâç
                    // offset=-2„ÅÆÂ†¥Âêà: week1=5ÈÄ±ÈñìÂâç„ÄÅweek2=4ÈÄ±ÈñìÂâç
                    const week1WeeksAgo = Math.abs(biweeklyOffset) * 2 + 1;
                    const week2WeeksAgo = Math.abs(biweeklyOffset) * 2;
                    
                    week1Label = `${week1WeeksAgo}ÈÄ±ÈñìÂâç`;
                    week2Label = `${week2WeeksAgo}ÈÄ±ÈñìÂâç`;
                }
                
                const statusContainer = document.getElementById('plantGoalStatus');
                if (statusContainer) {
                    statusContainer.innerHTML = `
                        <div class="plant-goal-item ${week1_achieved ? 'achieved' : 'not-achieved'}">
                            <div class="plant-goal-week">${week1Label}</div>
                            <div>${week1_unique_count} / 30Á®ÆÈ°û ${week1_achieved ? 'ÈÅîÊàêüéâ' : ''}</div>
                        </div>
                        <div class="plant-goal-item ${week2_achieved ? 'achieved' : 'not-achieved'}">
                            <div class="plant-goal-week">${week2Label}</div>
                            <div>${week2_unique_count} / 30Á®ÆÈ°û ${week2_achieved ? 'ÈÅîÊàêüéâ' : ''}</div>
                        </div>
                    `;
                }
                
                // ÊúüÈñìË°®Á§∫„ÇíÊõ¥Êñ∞
                updateBiweeklyPeriodText(biweeklyData);
            } catch (error) {
                console.error('Áµ±Ë®àÊõ¥Êñ∞„Ç®„É©„Éº:', error);
            }
        }
        
        // 2ÈÄ±Èñì„ÅÆÊúüÈñì„ÉÜ„Ç≠„Çπ„Éà„ÇíÊõ¥Êñ∞
        function updateBiweeklyPeriodText(biweeklyData) {
            const periodElement = document.getElementById('biweeklyPeriod');
            if (!periodElement || !biweeklyData || biweeklyData.length === 0) return;
            
            const startDate = biweeklyData[0].date;
            const endDate = biweeklyData[biweeklyData.length - 1].date;
            
            const startStr = startDate.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
            const endStr = endDate.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
            
            periodElement.textContent = `${startStr} „Äú ${endStr}`;
            
            // Ê¨°„ÅÆ2ÈÄ±Èñì„Éú„Çø„É≥„ÅÆÊúâÂäπ/ÁÑ°Âäπ„ÇíÂà∂Âæ°
            const nextBtn = document.getElementById('nextBiweeklyBtn');
            if (nextBtn) {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                if (endDate >= today || biweeklyOffset >= 0) {
                    nextBtn.disabled = true;
                    nextBtn.style.opacity = '0.5';
                    nextBtn.style.cursor = 'not-allowed';
                } else {
                    nextBtn.disabled = false;
                    nextBtn.style.opacity = '1';
                    nextBtn.style.cursor = 'pointer';
                }
            }
        }
        
        // 2ÈÄ±Èñì„ÅÆÊúüÈñì„ÇíÂ§âÊõ¥
        function changeBiweeklyPeriod(direction) {
            biweeklyOffset += direction;
            
            // Êú™Êù•„Å´„ÅØÈÄ≤„ÇÅ„Å™„ÅÑÂà∂Èôê
            if (biweeklyOffset > 0) {
                biweeklyOffset = 0;
            }
            
            // „É¨„Éù„Éº„Éà„ÇíÂÜçË™≠„ÅøËæº„Åø
            loadBiweeklyReport();
        }

        function createBiweeklyChart(biweeklyData) {
            try {
                const canvas = document.getElementById('biweeklyChart');
                if (!canvas) {
                    console.error('„Ç≠„É£„É≥„Éê„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }

                if (window.biweeklyChartInstance) {
                    window.biweeklyChartInstance.destroy();
                }
                
                if (!biweeklyData || biweeklyData.length === 0) {
                    console.error('2ÈÄ±Èñì„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô');
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                window.biweeklyChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: biweeklyData.map(day => day.dateStr),
                        datasets: [
                            {
                                label: 'Áô∫ÈÖµÈ£üÂìÅ(Á®ÆÈ°û)',
                                data: biweeklyData.map(day => day.fermented),
                                borderColor: '#4CAF50',
                                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                yAxisID: 'y',
                                tension: 0.3
                            },
                            {
                                label: 'È£üÁâ©ÁπäÁ∂≠(g)',
                                data: biweeklyData.map(day => day.fiber),
                                borderColor: '#FF9800',
                                backgroundColor: 'rgba(255, 152, 0, 0.1)',
                                yAxisID: 'y1',
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                beginAtZero: true,
                                title: { display: true, text: 'Á®ÆÈ°û' }
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                beginAtZero: true,
                                title: { display: true, text: '„Ç∞„É©„É†(g)' },
                                grid: { drawOnChartArea: false }
                            }
                        },
                        plugins: { legend: { position: 'top' } }
                    }
                });
            } catch (error) {
                console.error('„ÉÅ„É£„Éº„Éà‰ΩúÊàê„Ç®„É©„Éº:', error);
                showMessage('„ÉÅ„É£„Éº„Éà„ÅÆ‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Ç´„É¨„É≥„ÉÄ„Éº„Éö„Éº„Ç∏Ë™≠„ÅøËæº„Åø
        function loadCalendarPage() {
            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÂπ¥Êúà„ÇíÁèæÂú®„ÅÆÊó•‰ªò„Å´ÂàùÊúüÂåñ
            const today = new Date();
            calendarYear = today.getFullYear();
            calendarMonth = today.getMonth();
            
            // „Çø„Ç§„Éà„É´„ÇíÊõ¥Êñ∞
            const titleElement = document.getElementById('calendarTitle');
            if (titleElement) {
                titleElement.textContent = `${calendarYear}Âπ¥${calendarMonth + 1}Êúà`;
            }
            
            // Â∞ë„ÅóÈÅÖÂª∂„Åó„Å¶„Åã„Çâ„Ç´„É¨„É≥„ÉÄ„Éº„ÇíÁîüÊàêÔºàDOMË¶ÅÁ¥†„ÅåÁ¢∫ÂÆü„Å´Â≠òÂú®„Åô„Çã„Çà„ÅÜ„Å´Ôºâ
            setTimeout(() => {
                generateCalendar();
            }, 100);
        }

        // Ê∞ó„Å•„Åç„Ç¢„Ç§„Ç≥„É≥ÂèñÂæóÈñ¢Êï∞
        function getInsightIcon(insightId) {
            const insightMap = {
                'more': 'üçΩÔ∏è',
                'less': 'ü•Ñ',
                'spicy': 'üå∂Ô∏è',
                'water-more': 'üíß',
                'water-less': 'üèúÔ∏è',
                'caffeine': '‚òï',
                'exercise': 'üèÉ',
                'sleep-lack': 'üò¥',
                'medicine': 'üíä'
            };
            return insightMap[insightId] || '';
        }

        // Ëä±„Å≥„Çâ„ÅÆÈÅîÊàêÂ∫¶Âà§ÂÆöÈñ¢Êï∞
        function getPetalClass(value, type) {
            if (!value || value === 0) return '';
            
            let achievementLevel = 'low';
            
            switch(type) {
                case 'fermented':
                    if (value >= 2) achievementLevel = 'high';
                    else if (value >= 1) achievementLevel = 'medium';
                    break;
                case 'fiber':
                    const fiberRatio = value / settings.fiberGoal;
                    if (fiberRatio >= 1) achievementLevel = 'high';
                    else if (fiberRatio >= 0.7) achievementLevel = 'medium';
                    break;
                case 'plants':
                    if (value >= 4) achievementLevel = 'high';
                    else if (value >= 2) achievementLevel = 'medium';
                    break;
            }
            
            return `show ${achievementLevel}`;
        }

        // „Ç´„É¨„É≥„ÉÄ„ÉºÁîüÊàê
        function generateCalendar() {
            console.log('„Ç´„É¨„É≥„ÉÄ„ÉºÁîüÊàêÈñãÂßã:', calendarYear, calendarMonth);
            
            const grid = document.getElementById('calendarGrid');
            const title = document.getElementById('calendarTitle');
            
            if (!grid) {
                console.error('„Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„Éâ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('„Ç´„É¨„É≥„ÉÄ„Éº„Ç∞„É™„ÉÉ„ÉâÁô∫Ë¶ã:', grid);
            
            // „Çø„Ç§„Éà„É´Êõ¥Êñ∞
            if (title) {
                title.textContent = `${calendarYear}Âπ¥${calendarMonth + 1}Êúà`;
                console.log('„Çø„Ç§„Éà„É´Êõ¥Êñ∞:', title.textContent);
            }
            
            // ÊõúÊó•„Éò„ÉÉ„ÉÄ„Éº
            const weekdays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            let calendarHTML = '';
            
            weekdays.forEach(day => {
                calendarHTML += `<div class="weekday-header">${day}</div>`;
            });
            
            // „Ç´„É¨„É≥„ÉÄ„Éº„ÅÆÊó•‰ªò„ÇíÁîüÊàê
            const firstDay = new Date(calendarYear, calendarMonth, 1);
            const lastDay = new Date(calendarYear, calendarMonth + 1, 0);
            const startDay = firstDay.getDay();
            
            // Á©∫ÁôΩ„ÅÆ„Çª„É´
            for (let i = 0; i < startDay; i++) {
                calendarHTML += '<div class="calendar-day empty"></div>';
            }
            
            // ÂêÑÊó•‰ªò
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(calendarYear, calendarMonth, day);
                const dateKey = getDateKey(date);
                const dayData = appData[dateKey];
                
                // „Éá„Éº„ÇøÂèñÂæó
                const fermentedCount = dayData?.fermented?.length || 0;
                const fiberAmount = dayData?.fiber || 0;
                const plantCount = dayData?.plants?.length || 0;
                
                // Ê∞ó„Å•„Åç„Çø„Ç∞„ÅÆÂèñÂæó„Å®ÂàÜÈ°û
                const insights = dayData?.insights || [];
                const hasInsights = insights.length > 0;
                const hasCriticalInsights = insights.some(id => 
                    ['sleep-lack', 'medicine'].includes(id)
                );
                
                // ËÉåÊôØ„ÇØ„É©„Çπ„ÅÆÊ±∫ÂÆö
                let bgClass = '';
                if (hasCriticalInsights) {
                    bgClass = 'has-critical-insights';
                } else if (hasInsights) {
                    bgClass = 'has-insights';
                }
                
                // Ëä±„Å≥„Çâ„ÅÆË°®Á§∫„ÇØ„É©„ÇπÊ±∫ÂÆö
                const fermentedClass = getPetalClass(fermentedCount, 'fermented');
                const fiberClass = getPetalClass(fiberAmount, 'fiber');
                const plantsClass = getPetalClass(plantCount, 'plants');
                
                // ÂÖ®„Å¶È´òÈÅîÊàêÂ∫¶„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const isPerfect = fermentedClass.includes('high') && 
                                 fiberClass.includes('high') && 
                                 plantsClass.includes('high');
                
                calendarHTML += `
                    <div class="calendar-day ${isPerfect ? 'perfect' : ''} ${bgClass}" onclick="handleDateClick(${calendarYear}, ${calendarMonth}, ${day})">
                        <div class="day-number">${day}</div>
                        <div class="health-flower">
                            <div class="flower-center" ${!fermentedCount && !fiberAmount && !plantCount ? 'style="background: #ddd;"' : ''}></div>
                            ${fermentedCount > 0 ? `<div class="petal fermented ${fermentedClass}"></div>` : ''}
                            ${fiberAmount > 0 ? `<div class="petal fiber ${fiberClass}"></div>` : ''}
                            ${plantCount > 0 ? `<div class="petal plants ${plantsClass}"></div>` : ''}
                        </div>
                        <div class="tooltip">
                            <div class="tooltip-content">
                                ${fermentedCount > 0 ? `<div class="tooltip-item"><span class="tooltip-icon">ü´ò</span><span>Áô∫ÈÖµÈ£üÂìÅ: ${fermentedCount}Á®ÆÈ°û</span></div>` : ''}
                                ${fiberAmount > 0 ? `<div class="tooltip-item"><span class="tooltip-icon">üåæ</span><span>È£üÁâ©ÁπäÁ∂≠: ${fiberAmount}g</span></div>` : ''}
                                ${plantCount > 0 ? `<div class="tooltip-item"><span class="tooltip-icon">ü•¨</span><span>Ê§çÁâ©: ${plantCount}Á®ÆÈ°û</span></div>` : ''}
                                ${insights.length > 0 ? `
                                    <div class="tooltip-insights">
                                        ${insights.map(id => getInsightIcon(id)).join(' ')}
                                    </div>
                                ` : ''}
                                ${!fermentedCount && !fiberAmount && !plantCount && !hasInsights ? '<div>Ë®òÈå≤„Å™„Åó</div>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            grid.innerHTML = calendarHTML;
            console.log('„Ç´„É¨„É≥„ÉÄ„ÉºÁîüÊàêÂÆå‰∫Ü');
        }

        // „Ç´„É¨„É≥„ÉÄ„ÉºÊúàÂ§âÊõ¥
        function changeCalendarMonth(direction) {
            calendarMonth += direction;
            if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            } else if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            }
            
            // „Çø„Ç§„Éà„É´Êõ¥Êñ∞
            const title = document.getElementById('calendarTitle');
            if (title) {
                title.textContent = `${calendarYear}Âπ¥${calendarMonth + 1}Êúà`;
            }
            
            // „Ç´„É¨„É≥„ÉÄ„ÉºÂÜçÁîüÊàê
            generateCalendar();
        }

        // Êó•‰ªò„ÇØ„É™„ÉÉ„ÇØÂá¶ÁêÜÔºà„ÉÅ„ÉÉ„ÉóË°®Á§∫ or Ë®òÈå≤ÁîªÈù¢ÈÅ∑ÁßªÔºâ
        function handleDateClick(year, month, day) {
            const targetDate = new Date(year, month, day);
            const dateKey = getDateKey(targetDate);
            
            // Êó¢„Å´ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÊó•‰ªò„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„ÅüÂ†¥Âêà„ÅØË®òÈå≤ÁîªÈù¢„Å´ÈÅ∑Áßª
            if (selectedDate && selectedDate.getTime() === targetDate.getTime()) {
                jumpToDate(year, month, day);
                return;
            }
            
            // Êñ∞„Åó„ÅÑÊó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„ÉÅ„ÉÉ„ÉóË°®Á§∫
            selectedDate = targetDate;
            showTooltip(year, month, day);
        }

        // „ÉÅ„ÉÉ„ÉóË°®Á§∫
        function showTooltip(year, month, day) {
            // Êó¢Â≠ò„ÅÆ„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
            hideAllTooltips();
            
            // Ë©≤ÂΩì„Åô„ÇãÊó•‰ªò„ÅÆ„ÉÅ„ÉÉ„Éó„ÇíË°®Á§∫
            const targetDate = new Date(year, month, day);
            const dayElement = document.querySelector(`[onclick="handleDateClick(${year}, ${month}, ${day})"]`);
            if (dayElement) {
                const tooltip = dayElement.querySelector('.tooltip');
                if (tooltip) {
                    tooltip.style.opacity = '1';
                    tooltip.style.visibility = 'visible';
                }
            }
        }

        // „Åô„Åπ„Å¶„ÅÆ„ÉÅ„ÉÉ„Éó„ÇíÈùûË°®Á§∫
        function hideAllTooltips() {
            document.querySelectorAll('.tooltip').forEach(tooltip => {
                tooltip.style.opacity = '0';
                tooltip.style.visibility = 'hidden';
            });
        }

        // ÁâπÂÆö„ÅÆÊó•‰ªò„Å´„Ç∏„É£„É≥„Éó
        function jumpToDate(year, month, day) {
            try {
                currentDate = new Date(year, month, day);
                showPage('main');
                updateDateDisplay();
                loadCurrentDayData();
                updateSummary();
                
                // „Çπ„É†„Éº„Ç∫„Çπ„ÇØ„É≠„Éº„É´
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // „Éè„Ç§„É©„Ç§„ÉàÂäπÊûú
                showMessage(`${year}Âπ¥${month + 1}Êúà${day}Êó•„ÅÆË®òÈå≤ÁîªÈù¢„Å´ÁßªÂãï„Åó„Åæ„Åó„Åü`, 'success');
            } catch (error) {
                console.error('Êó•‰ªò„Ç∏„É£„É≥„Éó„Ç®„É©„Éº:', error);
                showMessage('Êó•‰ªò„ÅÆÁßªÂãï‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // Ë®≠ÂÆöÁîªÈù¢Ë™≠„ÅøËæº„Åø
        function loadSettingsPage() {
            // ÊÄßÂà•ÈÅ∏Êäû„ÅÆË°®Á§∫Êõ¥Êñ∞
            document.getElementById('gender-female').classList.toggle('selected', settings.gender === 'female');
            document.getElementById('gender-male').classList.toggle('selected', settings.gender === 'male');
            
            // È£üÁâ©ÁπäÁ∂≠ÁõÆÊ®ôÂÄ§„ÅÆË°®Á§∫Êõ¥Êñ∞
            document.getElementById('fiberGoalInput').value = settings.fiberGoal;
            
            // ÁõÆÊ®ôÂÄ§Â§âÊõ¥„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            document.getElementById('fiberGoalInput').addEventListener('input', function(e) {
                const newGoal = parseInt(e.target.value);
                if (newGoal >= 10 && newGoal <= 50) {
                    settings.fiberGoal = newGoal;
                    saveSettings();
                    updateSummary();
                    showMessage('ÁõÆÊ®ôÂÄ§„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü', 'success');
                }
            });
        }



        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showMessage(message, type = 'info') {
            try {
            // Êó¢Â≠ò„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂâäÈô§
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `success-message ${type}`;
            messageDiv.textContent = message;
            
            if (type === 'error') {
                messageDiv.style.background = '#f8d7da';
                messageDiv.style.color = '#721c24';
            }
            
                const mainContent = document.querySelector('.main-content');
                if (mainContent && mainContent.firstChild) {
                    mainContent.insertBefore(messageDiv, mainContent.firstChild);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 3000);
                }
            } catch (error) {
                console.error('„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫„Ç®„É©„Éº:', error);
            }
        }

        // „Å™„ÅúË®òÈå≤„Åô„ÇãÔºü„É¢„Éº„ÉÄ„É´
        function showWhyModal(section) {
            const content = getWhyContent(section);
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.background = 'rgba(0,0,0,0.6)';
            modal.style.zIndex = '3000';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            modal.innerHTML = `
                <div style="background:#fff; max-width: 460px; width: 90%; border-radius: 14px; padding: 18px 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.2);">
                    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom: 10px;">
                        <h3 style="font-size:18px; color:#333;">„Å™„ÅúË®òÈå≤„Åô„ÇãÔºü</h3>
                        <button onclick="this.closest('[style*=z-index]').remove()" style="border:none; background:#f0f0f0; width:32px; height:32px; border-radius:50%; cursor:pointer;">‚úï</button>
                    </div>
                    <div style="font-size:14px; color:#444; line-height:1.6;">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
        }

        function getWhyContent(section) {
            switch(section) {
                case 'fermented':
                    return `
                        <p><strong>ÁßëÂ≠¶ÁöÑÊ†πÊã†</strong><br>Áô∫ÈÖµÈ£üÂìÅ„ÅØÊúâÁî®ËèåÔºà„Éó„É≠„Éê„Ç§„Ç™„ÉÜ„Ç£„ÇØ„ÇπÔºâ„ÇíÂê´„Åø„ÄÅËÖ∏ÂÜÖÁí∞Â¢É„ÅÆÊîπÂñÑ„ÉªÂÖçÁñ´Ë™øÊï¥„ÉªÁÇéÁóá‰ΩéÊ∏õ„Å´ÂØÑ‰∏é„Åô„ÇãÁ†îÁ©∂„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÊúüÂæÖ„Åß„Åç„ÇãÂäπÊûú</strong><br>„ÅäÈÄö„Åò„ÅÆÊîπÂñÑ„ÄÅËÇå„ÉªÁù°Áú†„ÅÆË≥™Âêë‰∏ä„ÄÅ„Çπ„Éà„É¨„ÇπÁ∑©Âíå„Å™„Å©„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ</p>
                        <p><strong>„Éï„É≠„Éº„É©„Çπ„Ç≠„É£„É≥„Å®„ÅÆÈñ¢ÈÄ£ÊÄß</strong><br>ËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆ„Éê„É©„É≥„Çπ„ÇÑÂ§öÊßòÊÄßÊåáÊ®ô„ÅÆÊîπÂñÑ„ÅåË¶ãËæº„Åæ„Çå„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÂÆüË∑µ„ÅÆ„Ç≥„ÉÑ</strong><br>1Êó•2Á®ÆÈ°û„ÇíÁõÆÂÆâ„Å´„ÄÅÁ¥çË±Ü„Éª„É®„Éº„Ç∞„É´„Éà„ÉªÂë≥Âôå„Å™„Å©„Çí„É≠„Éº„ÉÜ„Éº„Ç∑„Éß„É≥„ÄÇ</p>
                    `;
                case 'fiber':
                    return `
                        <p><strong>ÁßëÂ≠¶ÁöÑÊ†πÊã†</strong><br>È£üÁâ©ÁπäÁ∂≠„ÅØÊúâÁî®Ëèå„ÅÆ„Ç®„ÇµÔºà„Éó„É¨„Éê„Ç§„Ç™„ÉÜ„Ç£„ÇØ„ÇπÔºâ„Å®„Å™„Çä„ÄÅË°ÄÁ≥ñ„ÉªËÑÇË≥™„Éª‰æøÈÄö„Å™„Å©ÁîüÊ¥ªÁøíÊÖ£ÁóÖ„É™„Çπ„ÇØ„Çí‰∏ã„Åí„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÊúüÂæÖ„Åß„Åç„ÇãÂäπÊûú</strong><br>‰æøÈÄöÊîπÂñÑ„ÄÅÈ£üÂæåÈ´òË°ÄÁ≥ñÊäëÂà∂„ÄÅLDL‰Ωé‰∏ã„ÄÅÊ∫ÄËÖπÊÑü„ÅÆÁ∂≠ÊåÅ„ÄÇ</p>
                        <p><strong>„Éï„É≠„Éº„É©„Çπ„Ç≠„É£„É≥„Å®„ÅÆÈñ¢ÈÄ£ÊÄß</strong><br>Áü≠ÈéñËÑÇËÇ™ÈÖ∏Áî£ÁîüËèå„ÅÆÂ¢óÂä†„ÇÑÂ§öÊßòÊÄßÂêë‰∏ä„Å´ÂØÑ‰∏é„Åó„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÂÆüË∑µ„ÅÆ„Ç≥„ÉÑ</strong><br>Â•≥ÊÄß18g/Êó•„ÉªÁî∑ÊÄß22g/Êó•„ÇíÊúÄ‰ΩéÁõÆÊ®ô„ÄÅÁêÜÊÉ≥„ÅØ25g/Êó•„ÇíÊÑèË≠ò„Åó„Å¶‰∏ªÈ£ü„ÉªÂâØËèú„ÅßÂàÜÊï£ÊëÇÂèñ„ÄÇ</p>
                    `;
                case 'plants':
                    return `
                        <p><strong>ÁßëÂ≠¶ÁöÑÊ†πÊã†</strong><br>Â§öÊßò„Å™Ê§çÁâ©ÊëÇÂèñ„ÅØËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆÂ§öÊßòÊÄß„Å®Èñ¢ÈÄ£„Åó„ÄÅÂÅ•Â∫∑„Ç¢„Ç¶„Éà„Ç´„É†„ÅÆÊîπÂñÑ„Å´Áµê„Å≥„Å§„Åç„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÊúüÂæÖ„Åß„Åç„ÇãÂäπÊûú</strong><br>ËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆ„É¨„Ç∏„É™„Ç®„É≥„ÇπÂêë‰∏ä„ÄÅ‰ª£Ë¨ù„ÉªÂÖçÁñ´„ÅÆÂÅ•ÂÖ®Âåñ„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ</p>
                        <p><strong>„Éï„É≠„Éº„É©„Çπ„Ç≠„É£„É≥„Å®„ÅÆÈñ¢ÈÄ£ÊÄß</strong><br>Â§öÊßòÊÄß„Çπ„Ç≥„Ç¢„ÅÆÂêë‰∏ä„Å´Áõ¥Áµê„Åó„Åæ„Åô„ÄÇ</p>
                        <p><strong>ÂÆüË∑µ„ÅÆ„Ç≥„ÉÑ</strong><br>ÈÄ±30Á®ÆÈ°û„ÇíÁõÆÊ®ô„Å´„ÄÅ1ÂõûÈáè„ÅØÂ∞ë„Å™„Åè„Å¶„ÇÇOK„ÄÇËâ≤„ÉªÁßëÁõÆ„Åå„Åã„Å∂„Çâ„Å™„ÅÑ„Çà„ÅÜ„Å´ÈÅ∏„Å∂„ÄÇ</p>
                    `;
            }
            return '';
        }



        // „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´Ë°®Á§∫
        function showTutorial() {
            if (!localStorage.getItem('pmcAppTutorialShown')) {
                const tutorial = `
                    <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center;">
                        <div style="background: white; padding: 24px; border-radius: 15px; max-width: 420px; margin: 20px;">
                            <h2 style="margin-bottom: 14px; color: #333;">„Çà„ÅÜ„Åì„ÅùÔºÅ„Åì„ÅÆ„Ç¢„Éó„É™„Åß„Åß„Åç„Çã„Åì„Å®</h2>
                            <div style="text-align: left; line-height: 1.6; font-size:14px;">
                                <p><strong>Áô∫ÈÖµÈ£üÂìÅ„ÇíË®òÈå≤</strong><br>
                                ËÖ∏ÂÜÖ„ÅÆÂñÑÁéâËèå„ÇíÂ¢ó„ÇÑ„Åó„Åæ„Åô„ÄÇÁõÆÊ®ôÔºö<strong>1Êó•2Á®ÆÈ°û‰ª•‰∏ä</strong></p>
                                <p><strong>È£üÁâ©ÁπäÁ∂≠„ÇíË®òÈå≤</strong><br>
                                ÂñÑÁéâËèå„ÅÆ„Ç®„Çµ„Å´„Å™„Çä„Åæ„Åô„ÄÇÁõÆÊ®ôÔºö<strong>Â•≥ÊÄß18g/Êó•„ÉªÁî∑ÊÄß22g/Êó•</strong>ÔºàÊé®Â•®Ôºö<strong>25g</strong>Ôºâ</p>
                                <p><strong>Ê§çÁâ©„ÅÆÂ§öÊßòÊÄß„ÇíË®òÈå≤</strong><br>
                                ËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆÂ§öÊßòÊÄß„ÇíÈ´ò„ÇÅ„Åæ„Åô„ÄÇÁõÆÊ®ôÔºö<strong>ÈÄ±30Á®ÆÈ°û</strong></p>
                            </div>
                            <div style="display:flex; gap:10px; margin-top: 16px;">
                                <button onclick="closeTutorial()" style="background: #4CAF50; color: white; border: none; padding: 12px 16px; border-radius: 8px; cursor: pointer; flex:1;">Âßã„ÇÅ„Çã</button>
                                <button onclick="localStorage.setItem('pmcAppTutorialShown','true'); closeTutorial()" style="background: #e9ecef; color: #333; border: none; padding: 12px 16px; border-radius: 8px; cursor: pointer;">„ÅÇ„Å®„Åß</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', tutorial);
            }
        }

        // „ÉÅ„É•„Éº„Éà„É™„Ç¢„É´Èñâ„Åò„Çã
        function closeTutorial() {
            const tutorial = document.querySelector('[style*="z-index: 2000"]');
            if (tutorial) {
                tutorial.remove();
                localStorage.setItem('pmcAppTutorialShown', 'true');
            }
        }

        // ÈÄ£Á∂öË®òÈå≤Êó•Êï∞Ë®àÁÆó
        function calculateStreak() {
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 365; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateKey = getDateKey(date);
                const dayData = appData[dateKey];
                
                if (dayData && (dayData.fermented.length > 0 || dayData.fiber > 0 || dayData.plants.length > 0)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            return streak;
        }

        // ÈÅîÊàê„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
        function checkAchievements() {
            const dateKey = getDateKey(currentDate);
            const dayData = appData[dateKey] || { fermented: [], fiber: 0, plants: [] };
            
            // Áô∫ÈÖµÈ£üÂìÅÁõÆÊ®ôÈÅîÊàê
            if (dayData.fermented.length >= 2) {
                showMessage('üéâ Áô∫ÈÖµÈ£üÂìÅ2Á®ÆÈ°ûÈÅîÊàêÔºÅËÖ∏ÂÜÖ„ÅÆÂñÑÁéâËèå„ÅåÂñú„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇÁ∂ôÁ∂ö„ÅßËÖ∏ÂÜÖÁí∞Â¢É„ÅÆÊîπÂñÑ„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ', 'success');
            }
            
            // È£üÁâ©ÁπäÁ∂≠ÁõÆÊ®ôÈÅîÊàê
            if (dayData.fiber >= settings.fiberGoal) {
                showMessage(`üéâ È£üÁâ©ÁπäÁ∂≠${settings.fiberGoal}gÈÅîÊàêÔºÅÂñÑÁéâËèå„ÅÆ„Ç®„Çµ„Åå„Åó„Å£„Åã„ÇäË£úÁµ¶„Åï„Çå„Åæ„Åó„Åü„ÄÇÁêÜÊÉ≥„ÅØ25g/Êó•„Åß„Åô„ÄÇ`, 'success');
            }
            
            // ÈÄ±Ê¨°Ê§çÁâ©ÁõÆÊ®ôÈÅîÊàê
            const weekPlants = getWeeklyPlants();
            const uniquePlants = [...new Set(weekPlants)];
            if (uniquePlants.length >= 30) {
                showMessage('üéâ ÈÄ±30Á®ÆÈ°ûÈÅîÊàêÔºÅËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆÂ§öÊßòÊÄß„Ç¢„ÉÉ„Éó„ÄÇ‰ΩìË™ø„ÅÆÂ∫ï‰∏ä„Åí„ÅåÊúüÂæÖ„Åß„Åç„Åæ„Åô„ÄÇ', 'success');
            }
        }

        // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©ÂåñÔºö„Éá„Éº„Çø„ÅÆÂÆöÊúü„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        function cleanupOldData() {
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            
            Object.keys(appData).forEach(dateKey => {
                const date = new Date(dateKey);
                if (date < oneMonthAgo) {
                    delete appData[dateKey];
                }
            });
            
            saveData();
        }

        // „Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞Âº∑Âåñ
        window.addEventListener('error', function(e) {
            console.error('„Ç¢„Éó„É™„Ç®„É©„Éº:', e.error);
            // Chart.js„ÅÆÂÜÖÈÉ®„Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
            if (e.error && e.error.message && e.error.message.includes('Chart')) {
                return;
            }
            // „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅÆ„Åø„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
            if (document.querySelector('.main-content')) {
            showMessage('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', 'error');
            }
        });

        // „Ç™„Éï„É©„Ç§„É≥ÂØæÂøú
        window.addEventListener('online', function() {
            showMessage('„Ç™„É≥„É©„Ç§„É≥„Å´Âæ©Â∏∞„Åó„Åæ„Åó„Åü', 'success');
        });

        window.addEventListener('offline', function() {
            showMessage('„Ç™„Éï„É©„Ç§„É≥„Åß„Åô„ÄÇ„Éá„Éº„Çø„ÅØ„É≠„Éº„Ç´„É´„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô„ÄÇ', 'error');
        });

        // ÊÄßÂà•Ë®≠ÂÆö
        function setGender(gender) {
            settings.gender = gender;
            
            // ÊÄßÂà•„Å´Âøú„Åò„Å¶ÁõÆÊ®ôÂÄ§„ÇíËá™ÂãïË®≠ÂÆö
            if (gender === 'female') {
                settings.fiberGoal = 18;
            } else if (gender === 'male') {
                settings.fiberGoal = 22;
            }
            
            saveSettings();
            updateSummary();
            
            // Ë®≠ÂÆöÁîªÈù¢„ÅÆË°®Á§∫Êõ¥Êñ∞
            if (currentPage === 'settings') {
                document.getElementById('gender-female').classList.toggle('selected', gender === 'female');
                document.getElementById('gender-male').classList.toggle('selected', gender === 'male');
                document.getElementById('fiberGoalInput').value = settings.fiberGoal;
            }
            
            showMessage(`${gender === 'female' ? 'Â•≥ÊÄß' : 'Áî∑ÊÄß'}„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„ÅüÔºàÁõÆÊ®ôÂÄ§: ${settings.fiberGoal}gÔºâ`, 'success');
        }

        // 2ÈÄ±Èñì„É¨„Éù„Éº„Éà„ÅÆTipsË°®Á§∫
        function showBiweeklyInfo() {
            const modal = document.createElement('div');
            modal.className = 'info-modal';
            modal.innerHTML = `
                <div class="info-modal-content">
                    <button class="info-modal-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                    <h3>„Å™„Åú2ÈÄ±Èñì„ÅßÊåØ„ÇäËøî„Çã„ÅÆÔºü</h3>
                    <p>
                        ÁßÅ„Åü„Å°„ÅÆËÖ∏ÂÜÖÁí∞Â¢É„ÅØ„ÄÅÈ£ü‰∫ã„ÇÑÁîüÊ¥ªÁøíÊÖ£„Å´„Çà„Å£„Å¶Êó•„ÄÖÂ§âÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ<br>
                        ÂÄã‰∫∫Â∑Æ„ÅØ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÈ£üÁîüÊ¥ª„ÅÆÊîπÂñÑ„ÇíÁ∂ö„Åë„Çã„Å®„ÄÅ<strong>Á¥Ñ2ÈÄ±Èñì</strong>„ÅßËÖ∏ÂÜÖÁ¥∞Ëèå„ÅÆ„Éê„É©„É≥„Çπ„Å´ËâØ„ÅÑÂ§âÂåñ„ÅÆÂÖÜ„Åó„ÅåË¶ã„ÅàÂßã„ÇÅ„Çã„Å®Ë®Ä„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                    </p>
                    <p>
                        „Åì„ÅÆ„É¨„Éù„Éº„Éà„ÅßÊó•„ÄÖ„ÅÆÁ©ç„ÅøÈáç„Å≠„ÇíÁ¢∫Ë™ç„Åó„ÄÅ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥Á∂≠ÊåÅ„Å´ÂΩπÁ´ã„Å¶„Åæ„Åó„Çá„ÅÜÔºÅ
                    </p>
                </div>
            `;
            document.body.appendChild(modal);
            
            // „É¢„Éº„ÉÄ„É´„ÅÆËÉåÊôØ„Çí„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // „Éá„Éº„Çø„É™„Çª„ÉÉ„ÉàÊ©üËÉΩ
        function resetAllData() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                // LocalStorage„Åã„Çâ„Éá„Éº„Çø„ÇíÂâäÈô§
                localStorage.removeItem('pmcAppData');
                localStorage.removeItem('pmcAppSettings');
                localStorage.removeItem('pmcAppTutorialShown');
                localStorage.removeItem('pmcAppLastCleanup');
                
                // „Ç¢„Éó„É™„Éá„Éº„Çø„ÇíÂàùÊúüÂåñ
                appData = {};
                settings = {
                    gender: 'female',
                    fiberGoal: 18,
                    notifications: true
                };
                
                // „Ç¢„Éó„É™„ÇíÂÜçÂàùÊúüÂåñ
                initializeApp();
                showMessage('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü', 'success');
                
                // „É°„Ç§„É≥„Éö„Éº„Ç∏„Å´Êàª„Çã
                showPage('main');
            }
        }

        // ÂàùÊúüÂåñÂÆå‰∫Ü
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            loadSettings();
            initializeApp();
            setupEventListeners();
            showTutorial();
            
            // Êúà1Âõû„ÅÆ„Éá„Éº„Çø„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            const lastCleanup = localStorage.getItem('pmcAppLastCleanup');
            const now = new Date();
            if (!lastCleanup || (now - new Date(lastCleanup)) > 30 * 24 * 60 * 60 * 1000) {
                cleanupOldData();
                localStorage.setItem('pmcAppLastCleanup', now.toISOString());
            }
            
            // „Éá„Éº„Çø„É™„Çª„ÉÉ„ÉàÁî®„ÅÆ„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÔºàÈñãÁô∫Áî®Ôºâ
            // Ctrl+Shift+R „Åß„Éá„Éº„Çø„É™„Çª„ÉÉ„Éà
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                    e.preventDefault();
                    resetAllData();
                }
            });
        });
    </script>
</body>
</html>
